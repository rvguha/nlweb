2025-02-19 12:33:54,474 [MainThread] INFO [root.__init__:67] ThreadedHTTPServer initialized
2025-02-19 12:33:59,433 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1739997239433] Received GET request for path: /html/str_chat.html
2025-02-19 12:33:59,444 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1739997239444] Received GET request for path: /html/streaming.js
2025-02-19 12:33:59,457 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1739997239457] Received GET request for path: /favicon.ico
2025-02-19 12:34:15,544 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1739997255544] Received GET request for path: /?query=cardiac%20health%20in%20south%20asian%20men&site=npr%20podcasts&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-19 12:34:15,546 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:125] [req_1739997255544] Received parameters: {'query': ['cardiac health in south asian men'], 'site': ['npr podcasts'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-19 12:34:15,551 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:145] [req_1739997255544] Processing query with handler: BaseNLWebHandler
2025-02-19 12:34:15,552 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:183] [query_1739997255552] Starting query handling for site: npr podcasts, query_id: 
2025-02-19 12:34:18,708 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1739997258708] Received GET request for path: /html/info.png
2025-02-19 12:34:24,357 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:196] [query_1739997255552] Query handling completed successfully
2025-02-19 12:34:24,373 [Thread-6 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-19 12:37:28,979 [Thread-7 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-19 19:02:49,422 [Thread-5 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-22 10:28:44,452 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740248924451] Received GET request for path: /html/streaming.js
2025-02-22 10:28:44,484 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740248924484] Received GET request for path: /favicon.ico
2025-02-22 10:30:51,144 [Thread-9 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-22 10:31:59,925 [Thread-10 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740249119925] Received GET request for path: /html/str_chat.html
2025-02-22 10:31:59,936 [Thread-10 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740249119936] Received GET request for path: /html/clear.jpeg
2025-02-22 10:31:59,936 [Thread-11 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740249119936] Received GET request for path: /html/debug.png
2025-02-22 10:38:11,135 [Thread-10 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-22 10:38:11,135 [Thread-11 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-22 12:31:26,717 [Thread-8 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-23 11:02:39,699 [MainThread] INFO [root.__init__:66] ThreadedHTTPServer initialized
2025-02-23 11:02:43,124 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:103] [req_1740337363124] Received GET request for path: /html/str_chat.html
2025-02-23 11:02:43,136 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:103] [req_1740337363136] Received GET request for path: /html/streaming.js
2025-02-23 11:02:43,142 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:103] [req_1740337363142] Received GET request for path: /html/clear.jpeg
2025-02-23 11:02:43,142 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:103] [req_1740337363142] Received GET request for path: /html/debug.png
2025-02-23 11:02:43,156 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:103] [req_1740337363156] Received GET request for path: /favicon.ico
2025-02-23 11:03:18,024 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:103] [req_1740337398024] Received GET request for path: /?query=houses%20in%20cupertino%20costing%20less%20than%203%20million%2C%20with%204%20bedrooms&site=zillow&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-23 11:03:18,027 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:124] [req_1740337398024] Received parameters: {'query': ['houses in cupertino costing less than 3 million, with 4 bedrooms'], 'site': ['zillow'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-23 11:03:18,030 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:144] [req_1740337398024] Processing query with handler: LocationSensitiveHandler
2025-02-23 11:03:18,031 [Thread-5 (process_request_thread)] INFO [StreamingHandler.handle_query:182] [query_1740337398031] Starting query handling for site: zillow, query_id: 
2025-02-23 11:03:19,206 [Thread-5 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:35] location_known in zillow: True
2025-02-23 11:03:20,007 [Thread-5 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:35] location_known in zillow: True
2025-02-23 11:03:22,780 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:103] [req_1740337402780] Received GET request for path: /html/info.png
2025-02-23 11:03:28,266 [Thread-5 (process_request_thread)] INFO [StreamingHandler.handle_query:195] [query_1740337398031] Query handling completed successfully
2025-02-23 11:03:28,279 [Thread-5 (process_request_thread)] INFO [StreamingHandler.__init__:77] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-23 11:06:34,441 [Thread-7 (process_request_thread)] INFO [StreamingHandler.__init__:77] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-23 11:21:24,067 [MainThread] INFO [root.__init__:67] ThreadedHTTPServer initialized
2025-02-23 11:22:07,092 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740338527092] Received GET request for path: /?query=south%20american%20salads&site=latam_recipes&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-23 11:22:07,094 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:125] [req_1740338527092] Received parameters: {'query': ['south american salads'], 'site': ['latam_recipes'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-23 11:22:07,097 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:145] [req_1740338527092] Processing query with handler: ItemTypeSensitiveRedirectHandler
2025-02-23 11:22:07,098 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:183] [query_1740338527098] Starting query handling for site: latam_recipes, query_id: 
2025-02-23 11:22:07,928 [Thread-6 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:22] item_type in latam: Recipe
2025-02-23 11:22:13,222 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:196] [query_1740338527098] Query handling completed successfully
2025-02-23 11:22:13,238 [Thread-6 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-23 11:22:23,341 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740338543341] Received GET request for path: /?query=restaurants%20near%20mountain%20view%20where%20I%20can%20get%20these&site=latam_recipes&model=gpt-4o-mini&prev=%5B%22south%20american%20salads%22%5D&item_to_remember=&context_url=
2025-02-23 11:22:23,343 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:125] [req_1740338543341] Received parameters: {'query': ['restaurants near mountain view where I can get these'], 'site': ['latam_recipes'], 'model': ['gpt-4o-mini'], 'prev': ['["south american salads"]']}
2025-02-23 11:22:23,345 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:145] [req_1740338543341] Processing query with handler: ItemTypeSensitiveRedirectHandler
2025-02-23 11:22:23,345 [Thread-7 (process_request_thread)] INFO [StreamingHandler.handle_query:183] [query_1740338543345] Starting query handling for site: latam_recipes, query_id: 
2025-02-23 11:22:23,353 [Thread-7 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.425697 seconds
2025-02-23 11:22:24,423 [Thread-7 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:22] item_type in latam: Restaurant
2025-02-23 11:22:24,424 [Thread-7 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:28] Setting site to ['tripadvisor']
2025-02-23 11:22:29,022 [Thread-7 (process_request_thread)] INFO [StreamingHandler.handle_query:196] [query_1740338543345] Query handling completed successfully
2025-02-23 11:22:29,028 [Thread-7 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-23 12:05:38,224 [MainThread] INFO [root.__init__:67] ThreadedHTTPServer initialized
2025-02-23 12:09:44,388 [MainThread] INFO [root.__init__:67] ThreadedHTTPServer initialized
2025-02-23 12:14:17,056 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740341657056] Received GET request for path: /html/str_chat.html
2025-02-23 12:14:17,084 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740341657084] Received GET request for path: /favicon.ico
2025-02-23 12:14:26,203 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740341666203] Received GET request for path: /?query=who%20are%20the%20actors%20in%20Blade%20Runner&site=imdb&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-23 12:14:26,205 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:125] [req_1740341666203] Received parameters: {'query': ['who are the actors in Blade Runner'], 'site': ['imdb'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-23 12:14:26,207 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:145] [req_1740341666203] Processing query with handler: GraphStructureHandler
2025-02-23 12:14:26,208 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:183] [query_1740341666208] Starting query handling for site: imdb, query_id: 
2025-02-23 12:14:28,700 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.handle_query:198] [query_1740341666208] Error in handle_query: 'item_details_query'
2025-02-23 12:14:28,704 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.handle_query:199] [query_1740341666208] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 192, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/graph.py", line 63, in getRankedAnswers
    await self.analyzeQuery()
  File "/Users/guha/nlweb/c2/graph.py", line 59, in analyzeQuery
    await asyncio.gather(*task_set)
  File "/Users/guha/nlweb/c2/graph.py", line 43, in isItemDetailsQuery
    self.item_details_query = response["item_details_query"]
                              ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
KeyError: 'item_details_query'

2025-02-23 12:14:28,705 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.do_GET:154] [req_1740341666203] Error handling request: 'item_details_query'
2025-02-23 12:14:28,708 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.do_GET:155] [req_1740341666203] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 146, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 192, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/graph.py", line 63, in getRankedAnswers
    await self.analyzeQuery()
  File "/Users/guha/nlweb/c2/graph.py", line 59, in analyzeQuery
    await asyncio.gather(*task_set)
  File "/Users/guha/nlweb/c2/graph.py", line 43, in isItemDetailsQuery
    self.item_details_query = response["item_details_query"]
                              ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
KeyError: 'item_details_query'

2025-02-23 12:14:28,709 [Thread-6 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-23 12:14:31,713 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740341671713] Received GET request for path: /?query=who%20are%20the%20actors%20in%20Blade%20Runner&site=imdb&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-23 12:14:31,713 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:125] [req_1740341671713] Received parameters: {'query': ['who are the actors in Blade Runner'], 'site': ['imdb'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-23 12:14:31,714 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:145] [req_1740341671713] Processing query with handler: GraphStructureHandler
2025-02-23 12:14:31,714 [Thread-7 (process_request_thread)] INFO [StreamingHandler.handle_query:183] [query_1740341671714] Starting query handling for site: imdb, query_id: 
2025-02-23 12:14:31,727 [Thread-7 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.427302 seconds
2025-02-23 12:14:31,728 [Thread-7 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.462915 seconds
2025-02-23 12:14:33,053 [Thread-7 (process_request_thread)] ERROR [StreamingHandler.handle_query:198] [query_1740341671714] Error in handle_query: 'item_details_query'
2025-02-23 12:14:33,055 [Thread-7 (process_request_thread)] ERROR [StreamingHandler.handle_query:199] [query_1740341671714] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 192, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/graph.py", line 63, in getRankedAnswers
    await self.analyzeQuery()
  File "/Users/guha/nlweb/c2/graph.py", line 59, in analyzeQuery
    await asyncio.gather(*task_set)
  File "/Users/guha/nlweb/c2/graph.py", line 43, in isItemDetailsQuery
    self.item_details_query = response["item_details_query"]
                              ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
KeyError: 'item_details_query'

2025-02-23 12:14:33,056 [Thread-7 (process_request_thread)] ERROR [StreamingHandler.do_GET:154] [req_1740341671713] Error handling request: 'item_details_query'
2025-02-23 12:14:33,058 [Thread-7 (process_request_thread)] ERROR [StreamingHandler.do_GET:155] [req_1740341671713] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 146, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 192, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/graph.py", line 63, in getRankedAnswers
    await self.analyzeQuery()
  File "/Users/guha/nlweb/c2/graph.py", line 59, in analyzeQuery
    await asyncio.gather(*task_set)
  File "/Users/guha/nlweb/c2/graph.py", line 43, in isItemDetailsQuery
    self.item_details_query = response["item_details_query"]
                              ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
KeyError: 'item_details_query'

2025-02-23 12:14:33,059 [Thread-7 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-23 12:15:15,087 [MainThread] INFO [root.__init__:67] ThreadedHTTPServer initialized
2025-02-23 12:15:16,116 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740341716116] Received GET request for path: /html/str_chat.html
2025-02-23 12:15:16,149 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740341716149] Received GET request for path: /favicon.ico
2025-02-23 12:15:24,533 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740341724533] Received GET request for path: /?query=who%20are%20the%20actors%20in%20blade%20runner&site=imdb&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-23 12:15:24,534 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:125] [req_1740341724533] Received parameters: {'query': ['who are the actors in blade runner'], 'site': ['imdb'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-23 12:15:24,536 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:145] [req_1740341724533] Processing query with handler: GraphStructureHandler
2025-02-23 12:15:24,537 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:183] [query_1740341724537] Starting query handling for site: imdb, query_id: 
2025-02-23 12:15:25,422 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.handle_query:198] [query_1740341724537] Error in handle_query: 'item_details'
2025-02-23 12:15:25,426 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.handle_query:199] [query_1740341724537] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 192, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/graph.py", line 63, in getRankedAnswers
    await self.analyzeQuery()
  File "/Users/guha/nlweb/c2/graph.py", line 59, in analyzeQuery
    await asyncio.gather(*task_set)
  File "/Users/guha/nlweb/c2/graph.py", line 43, in isItemDetailsQuery
    self.item_details_query = response["item_details"]
                              ~~~~~~~~^^^^^^^^^^^^^^^^
KeyError: 'item_details'

2025-02-23 12:15:25,427 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.do_GET:154] [req_1740341724533] Error handling request: 'item_details'
2025-02-23 12:15:25,430 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.do_GET:155] [req_1740341724533] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 146, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 192, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/graph.py", line 63, in getRankedAnswers
    await self.analyzeQuery()
  File "/Users/guha/nlweb/c2/graph.py", line 59, in analyzeQuery
    await asyncio.gather(*task_set)
  File "/Users/guha/nlweb/c2/graph.py", line 43, in isItemDetailsQuery
    self.item_details_query = response["item_details"]
                              ~~~~~~~~^^^^^^^^^^^^^^^^
KeyError: 'item_details'

2025-02-23 12:15:25,431 [Thread-6 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-23 12:15:28,436 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740341728436] Received GET request for path: /?query=who%20are%20the%20actors%20in%20blade%20runner&site=imdb&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-23 12:15:28,437 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:125] [req_1740341728436] Received parameters: {'query': ['who are the actors in blade runner'], 'site': ['imdb'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-23 12:15:28,437 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:145] [req_1740341728436] Processing query with handler: GraphStructureHandler
2025-02-23 12:15:28,438 [Thread-7 (process_request_thread)] INFO [StreamingHandler.handle_query:183] [query_1740341728438] Starting query handling for site: imdb, query_id: 
2025-02-23 12:15:28,453 [Thread-7 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.472699 seconds
2025-02-23 12:15:28,454 [Thread-7 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.382866 seconds
2025-02-23 12:15:29,830 [Thread-7 (process_request_thread)] ERROR [StreamingHandler.handle_query:198] [query_1740341728438] Error in handle_query: 'item_details'
2025-02-23 12:15:29,832 [Thread-7 (process_request_thread)] ERROR [StreamingHandler.handle_query:199] [query_1740341728438] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 192, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/graph.py", line 63, in getRankedAnswers
    await self.analyzeQuery()
  File "/Users/guha/nlweb/c2/graph.py", line 59, in analyzeQuery
    await asyncio.gather(*task_set)
  File "/Users/guha/nlweb/c2/graph.py", line 43, in isItemDetailsQuery
    self.item_details_query = response["item_details"]
                              ~~~~~~~~^^^^^^^^^^^^^^^^
KeyError: 'item_details'

2025-02-23 12:15:29,834 [Thread-7 (process_request_thread)] ERROR [StreamingHandler.do_GET:154] [req_1740341728436] Error handling request: 'item_details'
2025-02-23 12:15:29,836 [Thread-7 (process_request_thread)] ERROR [StreamingHandler.do_GET:155] [req_1740341728436] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 146, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 192, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/graph.py", line 63, in getRankedAnswers
    await self.analyzeQuery()
  File "/Users/guha/nlweb/c2/graph.py", line 59, in analyzeQuery
    await asyncio.gather(*task_set)
  File "/Users/guha/nlweb/c2/graph.py", line 43, in isItemDetailsQuery
    self.item_details_query = response["item_details"]
                              ~~~~~~~~^^^^^^^^^^^^^^^^
KeyError: 'item_details'

2025-02-23 12:15:29,837 [Thread-7 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-23 12:16:33,249 [MainThread] INFO [root.__init__:67] ThreadedHTTPServer initialized
2025-02-23 12:16:35,930 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740341795930] Received GET request for path: /?query=who%20are%20the%20actors%20in%20blade%20runner&site=imdb&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-23 12:16:35,931 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:125] [req_1740341795930] Received parameters: {'query': ['who are the actors in blade runner'], 'site': ['imdb'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-23 12:16:35,932 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:145] [req_1740341795930] Processing query with handler: GraphStructureHandler
2025-02-23 12:16:35,932 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:183] [query_1740341795932] Starting query handling for site: imdb, query_id: 
2025-02-23 12:16:37,001 [Thread-6 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:60] item_type in graph: Movie
2025-02-23 12:16:45,348 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:196] [query_1740341795932] Query handling completed successfully
2025-02-23 12:16:45,350 [Thread-6 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-23 12:17:41,535 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740341861535] Received GET request for path: /?query=movies%20involving%20android%20sheep&site=imdb&model=gpt-4o-mini&prev=%5B%22who%20are%20the%20actors%20in%20blade%20runner%22%5D&item_to_remember=&context_url=
2025-02-23 12:17:41,536 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:125] [req_1740341861535] Received parameters: {'query': ['movies involving android sheep'], 'site': ['imdb'], 'model': ['gpt-4o-mini'], 'prev': ['["who are the actors in blade runner"]']}
2025-02-23 12:17:41,537 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:145] [req_1740341861535] Processing query with handler: GraphStructureHandler
2025-02-23 12:17:41,538 [Thread-7 (process_request_thread)] INFO [StreamingHandler.handle_query:183] [query_1740341861538] Starting query handling for site: imdb, query_id: 
2025-02-23 12:17:41,547 [Thread-7 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.385933 seconds
2025-02-23 12:17:42,904 [Thread-7 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:60] item_type in graph: Movie
2025-02-23 12:17:43,938 [Thread-7 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:60] item_type in graph: Movie
2025-02-23 12:18:17,977 [Thread-7 (process_request_thread)] INFO [StreamingHandler.handle_query:196] [query_1740341861538] Query handling completed successfully
2025-02-23 12:18:17,987 [Thread-7 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-23 12:18:40,321 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740341920321] Received GET request for path: /?query=director%20of%20Star%20Wars&site=imdb&model=gpt-4o-mini&prev=%5B%22who%20are%20the%20actors%20in%20blade%20runner%22%2C%22movies%20involving%20android%20sheep%22%5D&item_to_remember=&context_url=
2025-02-23 12:18:40,322 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:125] [req_1740341920321] Received parameters: {'query': ['director of Star Wars'], 'site': ['imdb'], 'model': ['gpt-4o-mini'], 'prev': ['["who are the actors in blade runner","movies involving android sheep"]']}
2025-02-23 12:18:40,323 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:145] [req_1740341920321] Processing query with handler: GraphStructureHandler
2025-02-23 12:18:40,323 [Thread-8 (process_request_thread)] INFO [StreamingHandler.handle_query:183] [query_1740341920323] Starting query handling for site: imdb, query_id: 
2025-02-23 12:18:40,329 [Thread-8 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.467251 seconds
2025-02-23 12:18:41,538 [Thread-8 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:60] item_type in graph: Movie
2025-02-23 12:18:48,181 [Thread-8 (process_request_thread)] INFO [StreamingHandler.handle_query:196] [query_1740341920323] Query handling completed successfully
2025-02-23 12:18:48,184 [Thread-8 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-23 12:20:24,927 [MainThread] INFO [root.__init__:67] ThreadedHTTPServer initialized
2025-02-23 12:20:35,154 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740342035154] Received GET request for path: /html/str_chat.html
2025-02-23 12:20:35,192 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740342035192] Received GET request for path: /favicon.ico
2025-02-23 12:20:47,950 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740342047949] Received GET request for path: /?query=who%20are%20the%20directors%20of%20the%20different%20star%20wars%20movies&site=imdb&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-23 12:20:47,952 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:125] [req_1740342047949] Received parameters: {'query': ['who are the directors of the different star wars movies'], 'site': ['imdb'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-23 12:20:47,954 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:145] [req_1740342047949] Processing query with handler: GraphStructureHandler
2025-02-23 12:20:47,955 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:183] [query_1740342047955] Starting query handling for site: imdb, query_id: 
2025-02-23 12:20:49,351 [Thread-6 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:60] item_type in graph: Movie
2025-02-23 12:21:45,070 [MainThread] INFO [root.__init__:67] ThreadedHTTPServer initialized
2025-02-23 12:21:47,257 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740342107257] Received GET request for path: /?query=who%20are%20the%20directors%20of%20the%20different%20star%20wars%20movies&site=imdb&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-23 12:21:47,258 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:125] [req_1740342107257] Received parameters: {'query': ['who are the directors of the different star wars movies'], 'site': ['imdb'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-23 12:21:47,260 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:145] [req_1740342107257] Processing query with handler: GraphStructureHandler
2025-02-23 12:21:47,260 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:183] [query_1740342107260] Starting query handling for site: imdb, query_id: 
2025-02-23 12:21:47,902 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740342107901] Received GET request for path: /html/str_chat.html
2025-02-23 12:21:47,931 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740342107931] Received GET request for path: /html/streaming.js
2025-02-23 12:21:47,937 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740342107937] Received GET request for path: /html/debug.png
2025-02-23 12:21:47,940 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740342107940] Received GET request for path: /html/clear.jpeg
2025-02-23 12:21:47,945 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740342107945] Received GET request for path: /favicon.ico
2025-02-23 12:21:48,536 [Thread-6 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:60] item_type in graph: Movie
2025-02-23 12:21:49,936 [Thread-6 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:60] item_type in graph: Movie
2025-02-23 12:21:52,174 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.write_stream:215] Connection error while writing to stream: [Errno 32] Broken pipe
2025-02-23 12:21:52,174 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.handle_query:198] [query_1740342107260] Error in handle_query: [Errno 32] Broken pipe
2025-02-23 12:21:52,181 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.handle_query:199] [query_1740342107260] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 192, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/graph.py", line 65, in getRankedAnswers
    await super().getRankedAnswers()
  File "/Users/guha/nlweb/c2/baseHandler.py", line 167, in getRankedAnswers
    await asyncio.gather(*tasks)
  File "/Users/guha/nlweb/c2/baseHandler.py", line 92, in rankItem
    await self.sendAnswers([ansr])
  File "/Users/guha/nlweb/c2/baseHandler.py", line 124, in sendAnswers
    await self.http_handler.write_stream(to_send)
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 211, in write_stream
    self.wfile.write(data.encode('utf-8'))
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/socketserver.py", line 840, in write
    self._sock.sendall(b)
    ~~~~~~~~~~~~~~~~~~^^^
BrokenPipeError: [Errno 32] Broken pipe

2025-02-23 12:21:52,182 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.do_GET:154] [req_1740342107257] Error handling request: [Errno 32] Broken pipe
2025-02-23 12:21:52,185 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.do_GET:155] [req_1740342107257] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 146, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 192, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/graph.py", line 65, in getRankedAnswers
    await super().getRankedAnswers()
  File "/Users/guha/nlweb/c2/baseHandler.py", line 167, in getRankedAnswers
    await asyncio.gather(*tasks)
  File "/Users/guha/nlweb/c2/baseHandler.py", line 92, in rankItem
    await self.sendAnswers([ansr])
  File "/Users/guha/nlweb/c2/baseHandler.py", line 124, in sendAnswers
    await self.http_handler.write_stream(to_send)
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 211, in write_stream
    self.wfile.write(data.encode('utf-8'))
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/socketserver.py", line 840, in write
    self._sock.sendall(b)
    ~~~~~~~~~~~~~~~~~~^^^
BrokenPipeError: [Errno 32] Broken pipe

2025-02-23 12:21:52,186 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.do_GET:168] [req_1740342107257] Failed to send error response due to SSL/connection error: [Errno 32] Broken pipe
2025-02-23 12:21:52,186 [Thread-6 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-23 12:21:59,939 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740342119939] Received GET request for path: /?query=who%20are%20the%20directors%20of%20the%20Star%20Wars%20movies&site=imdb&model=auto&prev=%5B%5D&item_to_remember=&context_url=
2025-02-23 12:21:59,939 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:125] [req_1740342119939] Received parameters: {'query': ['who are the directors of the Star Wars movies'], 'site': ['imdb'], 'model': ['auto'], 'prev': ['[]']}
2025-02-23 12:21:59,940 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:145] [req_1740342119939] Processing query with handler: GraphStructureHandler
2025-02-23 12:21:59,940 [Thread-8 (process_request_thread)] INFO [StreamingHandler.handle_query:183] [query_1740342119940] Starting query handling for site: imdb, query_id: 
2025-02-23 12:21:59,947 [Thread-8 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.387917 seconds
2025-02-23 12:22:01,582 [Thread-8 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:60] item_type in graph: Movie
2025-02-23 12:22:02,531 [Thread-8 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:60] item_type in graph: Movie
2025-02-23 12:23:05,368 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740342185368] Received GET request for path: /html/str_chat.html
2025-02-23 12:23:05,377 [Thread-7 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-23 12:23:05,384 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740342185384] Received GET request for path: /html/streaming.js
2025-02-23 12:23:05,390 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740342185390] Received GET request for path: /html/debug.png
2025-02-23 12:23:05,390 [Thread-10 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740342185390] Received GET request for path: /html/clear.jpeg
2025-02-23 12:23:05,393 [Thread-10 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740342185393] Received GET request for path: /favicon.ico
2025-02-23 12:23:18,985 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740342198985] Received GET request for path: /?query=who%20are%20the%20directors%20of%20the%20Star%20wars%20movies&site=imdb&model=auto&prev=%5B%5D&item_to_remember=&context_url=
2025-02-23 12:23:18,986 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:125] [req_1740342198985] Received parameters: {'query': ['who are the directors of the Star wars movies'], 'site': ['imdb'], 'model': ['auto'], 'prev': ['[]']}
2025-02-23 12:23:18,987 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:145] [req_1740342198985] Processing query with handler: GraphStructureHandler
2025-02-23 12:23:18,988 [Thread-9 (process_request_thread)] INFO [StreamingHandler.handle_query:183] [query_1740342198988] Starting query handling for site: imdb, query_id: 
2025-02-23 12:23:20,011 [Thread-9 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:60] item_type in graph: Movie
2025-02-23 12:23:25,278 [Thread-9 (process_request_thread)] INFO [StreamingHandler.handle_query:196] [query_1740342198988] Query handling completed successfully
2025-02-23 12:23:25,280 [Thread-9 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-23 12:23:35,017 [Thread-8 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.446760 seconds
2025-02-23 12:23:40,837 [Thread-8 (process_request_thread)] INFO [StreamingHandler.handle_query:196] [query_1740342119940] Query handling completed successfully
2025-02-23 13:06:42,971 [MainThread] INFO [root.__init__:67] ThreadedHTTPServer initialized
2025-02-23 13:06:44,528 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740344804528] Received GET request for path: /html/str_chat.html
2025-02-23 13:06:44,538 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740344804538] Received GET request for path: /html/streaming.js
2025-02-23 13:06:44,559 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740344804559] Received GET request for path: /favicon.ico
2025-02-23 13:07:07,810 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740344827810] Received GET request for path: /?query=who%20are%20the%20directors%20of%20the%20Blade%20Runner%20movies&site=imdb&model=auto&prev=%5B%5D&item_to_remember=&context_url=
2025-02-23 13:07:07,812 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:125] [req_1740344827810] Received parameters: {'query': ['who are the directors of the Blade Runner movies'], 'site': ['imdb'], 'model': ['auto'], 'prev': ['[]']}
2025-02-23 13:07:07,814 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:145] [req_1740344827810] Processing query with handler: GraphStructureHandler
2025-02-23 13:07:07,815 [Thread-7 (process_request_thread)] INFO [StreamingHandler.handle_query:183] [query_1740344827815] Starting query handling for site: imdb, query_id: 
2025-02-23 13:07:09,273 [Thread-7 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:60] item_type in graph: Movie
2025-02-23 13:07:13,471 [Thread-7 (process_request_thread)] INFO [StreamingHandler.handle_query:196] [query_1740344827815] Query handling completed successfully
2025-02-23 13:07:13,473 [Thread-7 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-23 13:08:01,337 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740344881337] Received GET request for path: /?query=who%20are%20the%20directors%20of%20Blade%20Runner%2C%20Star%20Wars%20and%20Matrix&site=imdb&model=auto&prev=%5B%22who%20are%20the%20directors%20of%20the%20Blade%20Runner%20movies%22%5D&item_to_remember=&context_url=
2025-02-23 13:08:01,339 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:125] [req_1740344881337] Received parameters: {'query': ['who are the directors of Blade Runner, Star Wars and Matrix'], 'site': ['imdb'], 'model': ['auto'], 'prev': ['["who are the directors of the Blade Runner movies"]']}
2025-02-23 13:08:01,339 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:145] [req_1740344881337] Processing query with handler: GraphStructureHandler
2025-02-23 13:08:01,340 [Thread-8 (process_request_thread)] INFO [StreamingHandler.handle_query:183] [query_1740344881340] Starting query handling for site: imdb, query_id: 
2025-02-23 13:08:01,348 [Thread-8 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.466850 seconds
2025-02-23 13:08:02,768 [Thread-8 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:60] item_type in graph: Movie
2025-02-23 13:08:09,326 [Thread-8 (process_request_thread)] INFO [StreamingHandler.handle_query:196] [query_1740344881340] Query handling completed successfully
2025-02-23 13:08:09,328 [Thread-8 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-23 13:17:58,574 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740345478573] Received GET request for path: /?query=when%20was%20the%20original%20Blade%20Runner%20movie%20released&site=imdb&model=auto&prev=%5B%22who%20are%20the%20directors%20of%20the%20Blade%20Runner%20movies%22%2C%22who%20are%20the%20directors%20of%20Blade%20Runner%2C%20Star%20Wars%20and%20Matrix%22%5D&item_to_remember=&context_url=
2025-02-23 13:17:58,576 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:125] [req_1740345478573] Received parameters: {'query': ['when was the original Blade Runner movie released'], 'site': ['imdb'], 'model': ['auto'], 'prev': ['["who are the directors of the Blade Runner movies","who are the directors of Blade Runner, Star Wars and Matrix"]']}
2025-02-23 13:17:58,578 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:145] [req_1740345478573] Processing query with handler: GraphStructureHandler
2025-02-23 13:17:58,578 [Thread-9 (process_request_thread)] INFO [StreamingHandler.handle_query:183] [query_1740345478578] Starting query handling for site: imdb, query_id: 
2025-02-23 13:17:58,591 [Thread-9 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.487360 seconds
2025-02-23 13:18:00,538 [Thread-9 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:60] item_type in graph: Movie
2025-02-23 13:18:08,323 [Thread-9 (process_request_thread)] INFO [StreamingHandler.handle_query:196] [query_1740345478578] Query handling completed successfully
2025-02-23 13:18:08,326 [Thread-9 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-23 13:19:44,658 [MainThread] INFO [root.__init__:67] ThreadedHTTPServer initialized
2025-02-23 13:19:46,668 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740345586668] Received GET request for path: /html/str_chat.html
2025-02-23 13:19:46,693 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740345586693] Received GET request for path: /html/streaming.js
2025-02-23 13:19:46,700 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740345586700] Received GET request for path: /favicon.ico
2025-02-23 13:19:57,925 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740345597925] Received GET request for path: /?query=who%20are%20the%20actors%20in%20Eat%20Drink%20Man%20Woman&site=imdb&model=auto&prev=%5B%5D&item_to_remember=&context_url=
2025-02-23 13:19:57,926 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:125] [req_1740345597925] Received parameters: {'query': ['who are the actors in Eat Drink Man Woman'], 'site': ['imdb'], 'model': ['auto'], 'prev': ['[]']}
2025-02-23 13:19:57,928 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:145] [req_1740345597925] Processing query with handler: GraphStructureHandler
2025-02-23 13:19:57,929 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:183] [query_1740345597929] Starting query handling for site: imdb, query_id: 
2025-02-23 13:20:00,443 [Thread-6 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:61] item_type in graph: Movie
2025-02-23 13:20:06,981 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:196] [query_1740345597929] Query handling completed successfully
2025-02-23 13:20:06,985 [Thread-6 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 08:23:17,398 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740414197397] Received GET request for path: /?query=I%20am%20looking%20for%20a%20three%20bedroom%20in%20Cupertino&site=zillow&model=auto&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 08:23:17,401 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:125] [req_1740414197397] Received parameters: {'query': ['I am looking for a three bedroom in Cupertino'], 'site': ['zillow'], 'model': ['auto'], 'prev': ['[]']}
2025-02-24 08:23:17,403 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:145] [req_1740414197397] Processing query with handler: LocationSensitiveHandler
2025-02-24 08:23:17,404 [Thread-7 (process_request_thread)] INFO [StreamingHandler.handle_query:183] [query_1740414197404] Starting query handling for site: zillow, query_id: 
2025-02-24 08:23:17,417 [Thread-7 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.438910 seconds
2025-02-24 08:23:19,485 [Thread-7 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:35] location_known in zillow: True
2025-02-24 08:23:20,250 [Thread-7 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:35] location_known in zillow: True
2025-02-24 08:23:27,862 [Thread-7 (process_request_thread)] INFO [StreamingHandler.handle_query:196] [query_1740414197404] Query handling completed successfully
2025-02-24 08:23:27,873 [Thread-7 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 08:23:32,489 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740414212489] Received GET request for path: /?query=How%20about%20something%20with%20a%20pool%3F&site=zillow&model=auto&prev=%5B%22I%20am%20looking%20for%20a%20three%20bedroom%20in%20Cupertino%22%5D&item_to_remember=&context_url=
2025-02-24 08:23:32,489 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:125] [req_1740414212489] Received parameters: {'query': ['How about something with a pool?'], 'site': ['zillow'], 'model': ['auto'], 'prev': ['["I am looking for a three bedroom in Cupertino"]']}
2025-02-24 08:23:32,490 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:145] [req_1740414212489] Processing query with handler: LocationSensitiveHandler
2025-02-24 08:23:32,490 [Thread-8 (process_request_thread)] INFO [StreamingHandler.handle_query:183] [query_1740414212490] Starting query handling for site: zillow, query_id: 
2025-02-24 08:23:32,498 [Thread-8 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.440842 seconds
2025-02-24 08:23:32,505 [Thread-8 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.446662 seconds
2025-02-24 08:23:34,048 [Thread-8 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:35] location_known in zillow: False
2025-02-24 08:23:34,049 [Thread-8 (process_request_thread)] INFO [StreamingHandler.handle_query:196] [query_1740414212490] Query handling completed successfully
2025-02-24 08:23:34,052 [Thread-8 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 08:27:36,822 [MainThread] INFO [root.__init__:67] ThreadedHTTPServer initialized
2025-02-24 08:27:37,555 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740414457555] Received GET request for path: /html/str_chat.html
2025-02-24 08:27:37,571 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740414457571] Received GET request for path: /html/streaming.js
2025-02-24 08:27:37,599 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740414457599] Received GET request for path: /favicon.ico
2025-02-24 08:27:49,478 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740414469478] Received GET request for path: /?query=three%20bedroom%20house%20in%20cupertino&site=zillow&model=auto&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 08:27:49,479 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:125] [req_1740414469478] Received parameters: {'query': ['three bedroom house in cupertino'], 'site': ['zillow'], 'model': ['auto'], 'prev': ['[]']}
2025-02-24 08:27:49,483 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:145] [req_1740414469478] Processing query with handler: LocationSensitiveHandler
2025-02-24 08:27:49,483 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:183] [query_1740414469483] Starting query handling for site: zillow, query_id: 
2025-02-24 08:27:54,590 [Thread-6 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:34] location_known: True
2025-02-24 08:27:55,319 [Thread-6 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:34] location_known: True
2025-02-24 08:28:00,258 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:196] [query_1740414469483] Query handling completed successfully
2025-02-24 08:28:00,281 [Thread-6 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 08:28:14,008 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740414494008] Received GET request for path: /?query=how%20about%20one%20with%20a%20pool&site=zillow&model=auto&prev=%5B%22three%20bedroom%20house%20in%20cupertino%22%5D&item_to_remember=&context_url=
2025-02-24 08:28:14,009 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:125] [req_1740414494008] Received parameters: {'query': ['how about one with a pool'], 'site': ['zillow'], 'model': ['auto'], 'prev': ['["three bedroom house in cupertino"]']}
2025-02-24 08:28:14,009 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:145] [req_1740414494008] Processing query with handler: LocationSensitiveHandler
2025-02-24 08:28:14,010 [Thread-7 (process_request_thread)] INFO [StreamingHandler.handle_query:183] [query_1740414494010] Starting query handling for site: zillow, query_id: 
2025-02-24 08:28:14,017 [Thread-7 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.458162 seconds
2025-02-24 08:28:16,181 [Thread-7 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:34] location_known: True
2025-02-24 08:28:17,918 [Thread-7 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:34] location_known: True
2025-02-24 08:28:27,069 [Thread-7 (process_request_thread)] INFO [StreamingHandler.handle_query:196] [query_1740414494010] Query handling completed successfully
2025-02-24 08:28:27,087 [Thread-7 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 09:25:54,843 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740417954843] Received GET request for path: /html/debug.png
2025-02-24 09:25:58,434 [Thread-8 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 09:26:00,933 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740417960933] Received GET request for path: /html/nlwebsearch.html
2025-02-24 09:26:01,001 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740417961001] Received GET request for path: /favicon.ico
2025-02-24 09:27:06,463 [Thread-10 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740418026463] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20my%20diabetic%20dad%2C%20who%20likes%20italian%20food.%20He%20needs%20to%20eat%20a%20lot%20of%20fiber.%20Can%20you%20suggest%20a%20menu%3F&site=all&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 09:27:06,464 [Thread-10 (process_request_thread)] INFO [StreamingHandler.do_GET:125] [req_1740418026463] Received parameters: {'query': ['I am trying to prepare a three course dinner for my diabetic dad, who likes italian food. He needs to eat a lot of fiber. Can you suggest a menu?'], 'site': ['all'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 09:27:06,466 [Thread-10 (process_request_thread)] INFO [StreamingHandler.do_GET:145] [req_1740418026463] Processing query with handler: BaseNLWebHandler
2025-02-24 09:27:06,466 [Thread-10 (process_request_thread)] INFO [StreamingHandler.handle_query:183] [query_1740418026466] Starting query handling for site: all, query_id: 
2025-02-24 09:27:07,716 [Thread-10 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.382165 seconds
2025-02-24 09:27:13,707 [Thread-10 (process_request_thread)] INFO [StreamingHandler.handle_query:196] [query_1740418026466] Query handling completed successfully
2025-02-24 09:27:13,719 [Thread-10 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 09:27:57,135 [Thread-11 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740418077135] Received GET request for path: /html/nlwebsearch.html
2025-02-24 09:27:57,143 [Thread-9 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 09:27:57,155 [Thread-11 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740418077155] Received GET request for path: /favicon.ico
2025-02-24 09:28:25,969 [Thread-12 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740418105969] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20my%20diabetic%20dad%2C%20who%20likes%20italian%20food.%20He%20needs%20to%20eat%20a%20lot%20of%20fiber.%20Can%20you%20suggest%20a%20menu%20including%20an%20appetizer%20or%20salad%2C%20main%20course%20and%20a%20light%20dessert%3F&site=all&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 09:28:25,970 [Thread-12 (process_request_thread)] INFO [StreamingHandler.do_GET:125] [req_1740418105969] Received parameters: {'query': ['I am trying to prepare a three course dinner for my diabetic dad, who likes italian food. He needs to eat a lot of fiber. Can you suggest a menu including an appetizer or salad, main course and a light dessert?'], 'site': ['all'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 09:28:25,971 [Thread-12 (process_request_thread)] INFO [StreamingHandler.do_GET:145] [req_1740418105969] Processing query with handler: BaseNLWebHandler
2025-02-24 09:28:25,972 [Thread-12 (process_request_thread)] INFO [StreamingHandler.handle_query:183] [query_1740418105972] Starting query handling for site: all, query_id: 
2025-02-24 09:28:26,969 [Thread-12 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.434055 seconds
2025-02-24 09:28:37,283 [Thread-12 (process_request_thread)] INFO [StreamingHandler.handle_query:196] [query_1740418105972] Query handling completed successfully
2025-02-24 09:28:37,293 [Thread-12 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 09:29:04,238 [Thread-13 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740418144238] Received GET request for path: /?query=What%20about%20the%20dessert%3F&site=all&model=gpt-4o-mini&prev=%5B%22I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20my%20diabetic%20dad%2C%20who%20likes%20italian%20food.%20He%20needs%20to%20eat%20a%20lot%20of%20fiber.%20Can%20you%20suggest%20a%20menu%20including%20an%20appetizer%20or%20salad%2C%20main%20course%20and%20a%20light%20dessert%3F%22%5D&item_to_remember=&context_url=
2025-02-24 09:29:04,238 [Thread-13 (process_request_thread)] INFO [StreamingHandler.do_GET:125] [req_1740418144238] Received parameters: {'query': ['What about the dessert?'], 'site': ['all'], 'model': ['gpt-4o-mini'], 'prev': ['["I am trying to prepare a three course dinner for my diabetic dad, who likes italian food. He needs to eat a lot of fiber. Can you suggest a menu including an appetizer or salad, main course and a light dessert?"]']}
2025-02-24 09:29:04,239 [Thread-13 (process_request_thread)] INFO [StreamingHandler.do_GET:145] [req_1740418144238] Processing query with handler: BaseNLWebHandler
2025-02-24 09:29:04,240 [Thread-13 (process_request_thread)] INFO [StreamingHandler.handle_query:183] [query_1740418144240] Starting query handling for site: all, query_id: 
2025-02-24 09:29:04,246 [Thread-13 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.491943 seconds
2025-02-24 09:29:14,705 [Thread-13 (process_request_thread)] INFO [StreamingHandler.handle_query:196] [query_1740418144240] Query handling completed successfully
2025-02-24 09:29:14,714 [Thread-13 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 09:40:14,562 [Thread-14 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740418814562] Received GET request for path: /html/nlwebsearch.html
2025-02-24 09:40:14,570 [Thread-11 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 09:40:14,583 [Thread-14 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740418814582] Received GET request for path: /favicon.ico
2025-02-24 09:41:23,869 [Thread-15 (process_request_thread)] INFO [StreamingHandler.do_GET:104] [req_1740418883869] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=all&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 09:41:23,871 [Thread-15 (process_request_thread)] INFO [StreamingHandler.do_GET:125] [req_1740418883869] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['all'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 09:41:23,872 [Thread-15 (process_request_thread)] INFO [StreamingHandler.do_GET:145] [req_1740418883869] Processing query with handler: BaseNLWebHandler
2025-02-24 09:41:23,873 [Thread-15 (process_request_thread)] INFO [StreamingHandler.handle_query:183] [query_1740418883873] Starting query handling for site: all, query_id: 
2025-02-24 09:41:24,967 [Thread-15 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.444920 seconds
2025-02-24 09:41:29,861 [Thread-15 (process_request_thread)] INFO [StreamingHandler.handle_query:196] [query_1740418883873] Query handling completed successfully
2025-02-24 09:41:29,871 [Thread-15 (process_request_thread)] INFO [StreamingHandler.__init__:78] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 10:16:51,464 [MainThread] INFO [root.__init__:68] ThreadedHTTPServer initialized
2025-02-24 10:16:57,453 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740421017453] Received GET request for path: /html/nlws.html
2025-02-24 10:16:57,485 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740421017485] Received GET request for path: /favicon.ico
2025-02-24 10:17:02,949 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740421022949] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 10:17:02,951 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740421022949] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 10:17:02,953 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740421022949] Processing query with handler: BaseNLWebHandler
2025-02-24 10:17:02,954 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740421022954] Starting query handling for site: nlws, query_id: 
2025-02-24 10:17:11,439 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740421022954] Query handling completed successfully
2025-02-24 10:17:11,449 [Thread-6 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 10:18:11,382 [MainThread] INFO [root.__init__:68] ThreadedHTTPServer initialized
2025-02-24 10:18:16,306 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740421096306] Received GET request for path: /html/nlws.html
2025-02-24 10:18:16,342 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740421096342] Received GET request for path: /favicon.ico
2025-02-24 10:18:20,013 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740421100013] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 10:18:20,014 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740421100013] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 10:18:20,016 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740421100013] Processing query with handler: BaseNLWebHandler
2025-02-24 10:18:20,017 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740421100017] Starting query handling for site: nlws, query_id: 
2025-02-24 10:18:27,031 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740421100017] Query handling completed successfully
2025-02-24 10:18:27,044 [Thread-6 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 10:19:56,986 [MainThread] INFO [root.__init__:68] ThreadedHTTPServer initialized
2025-02-24 10:20:35,583 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740421235583] Received GET request for path: /html/nlws.html
2025-02-24 10:20:35,609 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740421235609] Received GET request for path: /favicon.ico
2025-02-24 10:20:39,603 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740421239603] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 10:20:39,603 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740421239603] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 10:20:39,605 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740421239603] Processing query with handler: NLWSHandler
2025-02-24 10:20:39,606 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740421239606] Starting query handling for site: nlws, query_id: 
2025-02-24 10:20:53,717 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740421239606] Query handling completed successfully
2025-02-24 10:20:53,748 [Thread-6 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 10:39:30,302 [MainThread] INFO [root.__init__:68] ThreadedHTTPServer initialized
2025-02-24 10:39:30,324 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740422370324] Received GET request for path: /html/nlws.html
2025-02-24 10:39:30,334 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740422370334] Received GET request for path: /html/streaming.js
2025-02-24 10:39:30,350 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740422370350] Received GET request for path: /favicon.ico
2025-02-24 10:39:33,639 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740422373639] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 10:39:33,640 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740422373639] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 10:39:33,643 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740422373639] Processing query with handler: NLWSHandler
2025-02-24 10:39:33,644 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740422373643] Starting query handling for site: nlws, query_id: 
2025-02-24 10:40:03,229 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.handle_query:202] [query_1740422373643] Error in handle_query: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:40:03,237 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.handle_query:203] [query_1740422373643] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:40:03,238 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.do_GET:158] [req_1740422373639] Error handling request: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:40:03,242 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.do_GET:159] [req_1740422373639] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 150, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:40:03,243 [Thread-6 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 10:40:06,251 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740422406251] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 10:40:06,251 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740422406251] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 10:40:06,252 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740422406251] Processing query with handler: NLWSHandler
2025-02-24 10:40:06,252 [Thread-7 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740422406252] Starting query handling for site: nlws, query_id: 
2025-02-24 10:40:07,064 [Thread-7 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.433576 seconds
2025-02-24 10:40:31,326 [Thread-7 (process_request_thread)] ERROR [StreamingHandler.handle_query:202] [query_1740422406252] Error in handle_query: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:40:31,330 [Thread-7 (process_request_thread)] ERROR [StreamingHandler.handle_query:203] [query_1740422406252] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:40:31,331 [Thread-7 (process_request_thread)] ERROR [StreamingHandler.do_GET:158] [req_1740422406251] Error handling request: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:40:31,334 [Thread-7 (process_request_thread)] ERROR [StreamingHandler.do_GET:159] [req_1740422406251] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 150, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:40:31,335 [Thread-7 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 10:40:34,340 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740422434340] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 10:40:34,340 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740422434340] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 10:40:34,341 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740422434340] Processing query with handler: NLWSHandler
2025-02-24 10:40:34,341 [Thread-8 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740422434341] Starting query handling for site: nlws, query_id: 
2025-02-24 10:40:34,934 [Thread-8 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.447538 seconds
2025-02-24 10:40:38,910 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740422438910] Received GET request for path: /html/nlws.html
2025-02-24 10:40:38,917 [Thread-5 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 10:40:38,929 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740422438929] Received GET request for path: /html/streaming.js
2025-02-24 10:40:38,938 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740422438938] Received GET request for path: /favicon.ico
2025-02-24 10:40:43,611 [Thread-10 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740422443611] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 10:40:43,612 [Thread-10 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740422443611] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 10:40:43,613 [Thread-10 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740422443611] Processing query with handler: NLWSHandler
2025-02-24 10:40:43,613 [Thread-10 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740422443613] Starting query handling for site: nlws, query_id: 
2025-02-24 10:40:56,628 [Thread-8 (process_request_thread)] ERROR [StreamingHandler.handle_query:202] [query_1740422434341] Error in handle_query: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:40:56,633 [Thread-8 (process_request_thread)] ERROR [StreamingHandler.handle_query:203] [query_1740422434341] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:40:56,634 [Thread-8 (process_request_thread)] ERROR [StreamingHandler.do_GET:158] [req_1740422434340] Error handling request: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:40:56,637 [Thread-8 (process_request_thread)] ERROR [StreamingHandler.do_GET:159] [req_1740422434340] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 150, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:40:56,638 [Thread-8 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 10:41:03,558 [Thread-10 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.477860 seconds
2025-02-24 10:41:17,224 [Thread-10 (process_request_thread)] ERROR [StreamingHandler.handle_query:202] [query_1740422443613] Error in handle_query: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:41:17,228 [Thread-10 (process_request_thread)] ERROR [StreamingHandler.handle_query:203] [query_1740422443613] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:41:17,230 [Thread-10 (process_request_thread)] ERROR [StreamingHandler.do_GET:158] [req_1740422443611] Error handling request: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:41:17,232 [Thread-10 (process_request_thread)] ERROR [StreamingHandler.do_GET:159] [req_1740422443611] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 150, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:41:17,233 [Thread-10 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 10:41:20,238 [Thread-11 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740422480238] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 10:41:20,238 [Thread-11 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740422480238] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 10:41:20,239 [Thread-11 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740422480238] Processing query with handler: NLWSHandler
2025-02-24 10:41:20,239 [Thread-11 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740422480239] Starting query handling for site: nlws, query_id: 
2025-02-24 10:41:21,644 [Thread-11 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.498334 seconds
2025-02-24 10:41:41,495 [Thread-11 (process_request_thread)] ERROR [StreamingHandler.handle_query:202] [query_1740422480239] Error in handle_query: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:41:41,498 [Thread-11 (process_request_thread)] ERROR [StreamingHandler.handle_query:203] [query_1740422480239] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:41:41,499 [Thread-11 (process_request_thread)] ERROR [StreamingHandler.do_GET:158] [req_1740422480238] Error handling request: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:41:41,502 [Thread-11 (process_request_thread)] ERROR [StreamingHandler.do_GET:159] [req_1740422480238] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 150, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:41:41,502 [Thread-11 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 10:45:23,693 [MainThread] INFO [root.__init__:68] ThreadedHTTPServer initialized
2025-02-24 10:45:39,273 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740422739273] Received GET request for path: /html/nlws.html
2025-02-24 10:45:39,301 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740422739301] Received GET request for path: /html/streaming.js
2025-02-24 10:45:39,341 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740422739341] Received GET request for path: /favicon.ico
2025-02-24 10:45:44,523 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740422744523] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 10:45:44,524 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740422744523] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 10:45:44,525 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740422744523] Processing query with handler: NLWSHandler
2025-02-24 10:45:44,526 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740422744526] Starting query handling for site: nlws, query_id: 
2025-02-24 10:46:10,247 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.handle_query:202] [query_1740422744526] Error in handle_query: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:46:10,254 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.handle_query:203] [query_1740422744526] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:46:10,255 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.do_GET:158] [req_1740422744523] Error handling request: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:46:10,258 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.do_GET:159] [req_1740422744523] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 150, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:46:10,259 [Thread-6 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 10:46:13,267 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740422773267] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 10:46:13,267 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740422773267] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 10:46:13,268 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740422773267] Processing query with handler: NLWSHandler
2025-02-24 10:46:13,268 [Thread-7 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740422773268] Starting query handling for site: nlws, query_id: 
2025-02-24 10:46:13,993 [Thread-7 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.394958 seconds
2025-02-24 10:46:34,565 [Thread-7 (process_request_thread)] ERROR [StreamingHandler.handle_query:202] [query_1740422773268] Error in handle_query: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:46:34,570 [Thread-7 (process_request_thread)] ERROR [StreamingHandler.handle_query:203] [query_1740422773268] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:46:34,571 [Thread-7 (process_request_thread)] ERROR [StreamingHandler.do_GET:158] [req_1740422773267] Error handling request: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:46:34,573 [Thread-7 (process_request_thread)] ERROR [StreamingHandler.do_GET:159] [req_1740422773267] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 150, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:46:34,575 [Thread-7 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 10:46:37,582 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740422797582] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 10:46:37,582 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740422797582] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 10:46:37,583 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740422797582] Processing query with handler: NLWSHandler
2025-02-24 10:46:37,583 [Thread-8 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740422797583] Starting query handling for site: nlws, query_id: 
2025-02-24 10:46:38,462 [Thread-8 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.412264 seconds
2025-02-24 10:46:57,501 [Thread-8 (process_request_thread)] ERROR [StreamingHandler.handle_query:202] [query_1740422797583] Error in handle_query: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:46:57,504 [Thread-8 (process_request_thread)] ERROR [StreamingHandler.handle_query:203] [query_1740422797583] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:46:57,504 [Thread-8 (process_request_thread)] ERROR [StreamingHandler.do_GET:158] [req_1740422797582] Error handling request: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:46:57,507 [Thread-8 (process_request_thread)] ERROR [StreamingHandler.do_GET:159] [req_1740422797582] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 150, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:46:57,507 [Thread-8 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 10:47:00,515 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740422820515] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 10:47:00,516 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740422820515] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 10:47:00,517 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740422820515] Processing query with handler: NLWSHandler
2025-02-24 10:47:00,518 [Thread-9 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740422820518] Starting query handling for site: nlws, query_id: 
2025-02-24 10:47:01,112 [Thread-9 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.483162 seconds
2025-02-24 10:47:29,476 [Thread-9 (process_request_thread)] ERROR [StreamingHandler.handle_query:202] [query_1740422820518] Error in handle_query: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:47:29,483 [Thread-9 (process_request_thread)] ERROR [StreamingHandler.handle_query:203] [query_1740422820518] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:47:29,485 [Thread-9 (process_request_thread)] ERROR [StreamingHandler.do_GET:158] [req_1740422820515] Error handling request: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:47:29,487 [Thread-9 (process_request_thread)] ERROR [StreamingHandler.do_GET:159] [req_1740422820515] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 150, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:47:29,488 [Thread-9 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 10:47:32,495 [Thread-10 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740422852495] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 10:47:32,495 [Thread-10 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740422852495] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 10:47:32,497 [Thread-10 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740422852495] Processing query with handler: NLWSHandler
2025-02-24 10:47:32,498 [Thread-10 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740422852498] Starting query handling for site: nlws, query_id: 
2025-02-24 10:47:33,741 [Thread-10 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.450392 seconds
2025-02-24 10:47:56,284 [Thread-10 (process_request_thread)] ERROR [StreamingHandler.handle_query:202] [query_1740422852498] Error in handle_query: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:47:56,288 [Thread-10 (process_request_thread)] ERROR [StreamingHandler.handle_query:203] [query_1740422852498] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:47:56,289 [Thread-10 (process_request_thread)] ERROR [StreamingHandler.do_GET:158] [req_1740422852495] Error handling request: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:47:56,292 [Thread-10 (process_request_thread)] ERROR [StreamingHandler.do_GET:159] [req_1740422852495] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 150, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:47:56,293 [Thread-10 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 10:47:59,301 [Thread-11 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740422879301] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 10:47:59,302 [Thread-11 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740422879301] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 10:47:59,303 [Thread-11 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740422879301] Processing query with handler: NLWSHandler
2025-02-24 10:47:59,303 [Thread-11 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740422879303] Starting query handling for site: nlws, query_id: 
2025-02-24 10:48:00,021 [Thread-11 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.439027 seconds
2025-02-24 10:48:18,297 [Thread-11 (process_request_thread)] ERROR [StreamingHandler.handle_query:202] [query_1740422879303] Error in handle_query: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:48:18,303 [Thread-11 (process_request_thread)] ERROR [StreamingHandler.handle_query:203] [query_1740422879303] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:48:18,304 [Thread-11 (process_request_thread)] ERROR [StreamingHandler.do_GET:158] [req_1740422879301] Error handling request: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:48:18,306 [Thread-11 (process_request_thread)] ERROR [StreamingHandler.do_GET:159] [req_1740422879301] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 150, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:48:18,307 [Thread-11 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 10:48:21,315 [Thread-12 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740422901315] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 10:48:21,315 [Thread-12 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740422901315] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 10:48:21,316 [Thread-12 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740422901315] Processing query with handler: NLWSHandler
2025-02-24 10:48:21,317 [Thread-12 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740422901317] Starting query handling for site: nlws, query_id: 
2025-02-24 10:48:22,444 [Thread-12 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.473702 seconds
2025-02-24 10:49:09,975 [Thread-12 (process_request_thread)] ERROR [StreamingHandler.handle_query:202] [query_1740422901317] Error in handle_query: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:49:09,981 [Thread-12 (process_request_thread)] ERROR [StreamingHandler.handle_query:203] [query_1740422901317] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:49:09,982 [Thread-12 (process_request_thread)] ERROR [StreamingHandler.do_GET:158] [req_1740422901315] Error handling request: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:49:09,985 [Thread-12 (process_request_thread)] ERROR [StreamingHandler.do_GET:159] [req_1740422901315] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 150, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:49:09,985 [Thread-12 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 10:49:12,992 [Thread-13 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740422952992] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 10:49:12,993 [Thread-13 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740422952992] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 10:49:12,995 [Thread-13 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740422952992] Processing query with handler: NLWSHandler
2025-02-24 10:49:12,996 [Thread-13 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740422952996] Starting query handling for site: nlws, query_id: 
2025-02-24 10:49:13,869 [Thread-13 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.430969 seconds
2025-02-24 10:49:34,560 [Thread-13 (process_request_thread)] ERROR [StreamingHandler.handle_query:202] [query_1740422952996] Error in handle_query: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:49:34,564 [Thread-13 (process_request_thread)] ERROR [StreamingHandler.handle_query:203] [query_1740422952996] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:49:34,565 [Thread-13 (process_request_thread)] ERROR [StreamingHandler.do_GET:158] [req_1740422952992] Error handling request: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:49:34,570 [Thread-13 (process_request_thread)] ERROR [StreamingHandler.do_GET:159] [req_1740422952992] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 150, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:49:34,571 [Thread-13 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 10:49:37,578 [Thread-14 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740422977578] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 10:49:37,578 [Thread-14 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740422977578] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 10:49:37,579 [Thread-14 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740422977578] Processing query with handler: NLWSHandler
2025-02-24 10:49:37,581 [Thread-14 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740422977581] Starting query handling for site: nlws, query_id: 
2025-02-24 10:49:38,196 [Thread-14 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.481203 seconds
2025-02-24 10:49:57,268 [Thread-14 (process_request_thread)] ERROR [StreamingHandler.handle_query:202] [query_1740422977581] Error in handle_query: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:49:57,272 [Thread-14 (process_request_thread)] ERROR [StreamingHandler.handle_query:203] [query_1740422977581] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:49:57,275 [Thread-14 (process_request_thread)] ERROR [StreamingHandler.do_GET:158] [req_1740422977578] Error handling request: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:49:57,278 [Thread-14 (process_request_thread)] ERROR [StreamingHandler.do_GET:159] [req_1740422977578] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 150, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:49:57,278 [Thread-14 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 10:50:00,300 [Thread-15 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740423000300] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 10:50:00,301 [Thread-15 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740423000300] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 10:50:00,303 [Thread-15 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740423000300] Processing query with handler: NLWSHandler
2025-02-24 10:50:00,304 [Thread-15 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740423000304] Starting query handling for site: nlws, query_id: 
2025-02-24 10:50:01,074 [Thread-15 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.469741 seconds
2025-02-24 10:50:20,039 [Thread-15 (process_request_thread)] ERROR [StreamingHandler.handle_query:202] [query_1740423000304] Error in handle_query: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:50:20,043 [Thread-15 (process_request_thread)] ERROR [StreamingHandler.handle_query:203] [query_1740423000304] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
    await self.decontextualizeQuery()
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    prompt_str, ans_struc = self.RANKING_PROMPT
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:50:20,044 [Thread-15 (process_request_thread)] ERROR [StreamingHandler.do_GET:158] [req_1740423000300] Error handling request: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:50:20,046 [Thread-15 (process_request_thread)] ERROR [StreamingHandler.do_GET:159] [req_1740423000300] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 150, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
    await self.decontextualizeQuery()
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    prompt_str, ans_struc = self.RANKING_PROMPT
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:50:20,047 [Thread-15 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 10:50:23,055 [Thread-16 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740423023055] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 10:50:23,055 [Thread-16 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740423023055] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 10:50:23,056 [Thread-16 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740423023055] Processing query with handler: NLWSHandler
2025-02-24 10:50:23,057 [Thread-16 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740423023057] Starting query handling for site: nlws, query_id: 
2025-02-24 10:50:23,568 [Thread-16 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.449176 seconds
2025-02-24 10:50:46,779 [Thread-16 (process_request_thread)] ERROR [StreamingHandler.handle_query:202] [query_1740423023057] Error in handle_query: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:50:46,785 [Thread-16 (process_request_thread)] ERROR [StreamingHandler.handle_query:203] [query_1740423023057] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    await self.synthesizeAnswer()
               ~~~~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:50:46,786 [Thread-16 (process_request_thread)] ERROR [StreamingHandler.do_GET:158] [req_1740423023055] Error handling request: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:50:46,789 [Thread-16 (process_request_thread)] ERROR [StreamingHandler.do_GET:159] [req_1740423023055] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 150, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 43, in getRankedAnswers
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in synthesizeAnswer
    await self.synthesizeAnswer()
               ~~~~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:50:46,789 [Thread-16 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 10:50:49,798 [Thread-17 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740423049798] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 10:50:49,799 [Thread-17 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740423049798] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 10:50:49,801 [Thread-17 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740423049798] Processing query with handler: NLWSHandler
2025-02-24 10:50:49,801 [Thread-17 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740423049801] Starting query handling for site: nlws, query_id: 
2025-02-24 10:50:50,592 [Thread-17 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.395158 seconds
2025-02-24 10:51:57,702 [MainThread] INFO [root.__init__:68] ThreadedHTTPServer initialized
2025-02-24 10:51:57,785 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740423117785] Received GET request for path: /html/nlws.html
2025-02-24 10:51:57,798 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740423117798] Received GET request for path: /html/streaming.js
2025-02-24 10:51:57,824 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740423117824] Received GET request for path: /favicon.ico
2025-02-24 10:52:01,249 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740423121249] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 10:52:01,250 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740423121249] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 10:52:01,251 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740423121249] Processing query with handler: NLWSHandler
2025-02-24 10:52:01,251 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740423121251] Starting query handling for site: nlws, query_id: 
2025-02-24 10:52:26,078 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.handle_query:202] [query_1740423121251] Error in handle_query: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:52:26,087 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.handle_query:203] [query_1740423121251] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 69, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:52:26,088 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.do_GET:158] [req_1740423121249] Error handling request: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]
2025-02-24 10:52:26,100 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.do_GET:159] [req_1740423121249] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 150, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 56, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 69, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string', 'description': 'string', 'name': 'string', 'site': 'string', 'image_url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string',
      'description': 'string',
      'name': 'string',
      'site': 'string',
      'image_url': 'string'}]

2025-02-24 10:52:26,107 [Thread-6 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 10:52:29,115 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740423149115] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 10:52:29,116 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740423149115] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 10:52:29,117 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740423149115] Processing query with handler: NLWSHandler
2025-02-24 10:52:29,117 [Thread-7 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740423149117] Starting query handling for site: nlws, query_id: 
2025-02-24 10:52:30,017 [Thread-7 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.397445 seconds
2025-02-24 10:56:17,762 [MainThread] INFO [root.__init__:68] ThreadedHTTPServer initialized
2025-02-24 10:56:17,878 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740423377878] Received GET request for path: /html/nlws.html
2025-02-24 10:56:17,906 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740423377906] Received GET request for path: /html/streaming.js
2025-02-24 10:56:17,944 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740423377944] Received GET request for path: /favicon.ico
2025-02-24 10:56:27,947 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740423387947] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 10:56:27,948 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740423387947] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 10:56:27,949 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740423387947] Processing query with handler: NLWSHandler
2025-02-24 10:56:27,950 [Thread-7 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740423387950] Starting query handling for site: nlws, query_id: 
2025-02-24 10:56:41,400 [Thread-7 (process_request_thread)] ERROR [StreamingHandler.handle_query:202] [query_1740423387950] Error in handle_query: Error getting completion: [{'url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string'}]
2025-02-24 10:56:41,408 [Thread-7 (process_request_thread)] ERROR [StreamingHandler.handle_query:203] [query_1740423387950] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 45, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 58, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string'}]

2025-02-24 10:56:41,409 [Thread-7 (process_request_thread)] ERROR [StreamingHandler.do_GET:158] [req_1740423387947] Error handling request: Error getting completion: [{'url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string'}]
2025-02-24 10:56:41,413 [Thread-7 (process_request_thread)] ERROR [StreamingHandler.do_GET:159] [req_1740423387947] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 150, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 45, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 58, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string'}]

2025-02-24 10:56:41,414 [Thread-7 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 10:56:44,423 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740423404423] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 10:56:44,425 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740423404423] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 10:56:44,426 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740423404423] Processing query with handler: NLWSHandler
2025-02-24 10:56:44,426 [Thread-8 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740423404426] Starting query handling for site: nlws, query_id: 
2025-02-24 10:56:44,943 [Thread-8 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.423647 seconds
2025-02-24 10:57:04,882 [Thread-8 (process_request_thread)] ERROR [StreamingHandler.handle_query:202] [query_1740423404426] Error in handle_query: Error getting completion: [{'url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string'}]
2025-02-24 10:57:04,886 [Thread-8 (process_request_thread)] ERROR [StreamingHandler.handle_query:203] [query_1740423404426] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 45, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 58, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string'}]

2025-02-24 10:57:04,887 [Thread-8 (process_request_thread)] ERROR [StreamingHandler.do_GET:158] [req_1740423404423] Error handling request: Error getting completion: [{'url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string'}]
2025-02-24 10:57:04,890 [Thread-8 (process_request_thread)] ERROR [StreamingHandler.do_GET:159] [req_1740423404423] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 150, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 45, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 58, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string'}]

2025-02-24 10:57:04,891 [Thread-8 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 10:57:07,899 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740423427899] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 10:57:07,900 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740423427899] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 10:57:07,900 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740423427899] Processing query with handler: NLWSHandler
2025-02-24 10:57:07,901 [Thread-9 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740423427901] Starting query handling for site: nlws, query_id: 
2025-02-24 10:57:08,386 [Thread-9 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.450738 seconds
2025-02-24 10:57:21,439 [Thread-9 (process_request_thread)] ERROR [StreamingHandler.handle_query:202] [query_1740423427901] Error in handle_query: Error getting completion: [{'url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string'}]
2025-02-24 10:57:21,443 [Thread-9 (process_request_thread)] ERROR [StreamingHandler.handle_query:203] [query_1740423427901] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 45, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 58, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string'}]

2025-02-24 10:57:21,444 [Thread-9 (process_request_thread)] ERROR [StreamingHandler.do_GET:158] [req_1740423427899] Error handling request: Error getting completion: [{'url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string'}]
2025-02-24 10:57:21,447 [Thread-9 (process_request_thread)] ERROR [StreamingHandler.do_GET:159] [req_1740423427899] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 150, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 45, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 58, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string'}]

2025-02-24 10:57:21,448 [Thread-9 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 10:57:24,455 [Thread-10 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740423444455] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 10:57:24,456 [Thread-10 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740423444455] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 10:57:24,457 [Thread-10 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740423444455] Processing query with handler: NLWSHandler
2025-02-24 10:57:24,458 [Thread-10 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740423444458] Starting query handling for site: nlws, query_id: 
2025-02-24 10:57:25,241 [Thread-10 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.496653 seconds
2025-02-24 10:57:43,705 [Thread-10 (process_request_thread)] ERROR [StreamingHandler.handle_query:202] [query_1740423444458] Error in handle_query: Error getting completion: [{'url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string'}]
2025-02-24 10:57:43,710 [Thread-10 (process_request_thread)] ERROR [StreamingHandler.handle_query:203] [query_1740423444458] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 45, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 58, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string'}]

2025-02-24 10:57:43,712 [Thread-10 (process_request_thread)] ERROR [StreamingHandler.do_GET:158] [req_1740423444455] Error handling request: Error getting completion: [{'url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string'}]
2025-02-24 10:57:43,715 [Thread-10 (process_request_thread)] ERROR [StreamingHandler.do_GET:159] [req_1740423444455] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/mllm.py", line 274, in get_structured_completion_async
    jsonschema.validate(instance=result, schema=json_schema)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 1328, in validate
    cls.check_schema(schema)
    ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/jsonschema/validators.py", line 317, in check_schema
    raise exceptions.SchemaError.create_from(error)
jsonschema.exceptions.SchemaError: [{'url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string'}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 150, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 45, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 58, in synthesizeAnswer
    response = await mllm.get_structured_completion_async(prompt, ans_struc, "gpt-4o")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/mllm.py", line 282, in get_structured_completion_async
    raise ValueError(f"Error getting completion: {e}")
ValueError: Error getting completion: [{'url': 'string'}] is not of type 'object', 'boolean'

Failed validating 'type' in metaschema['allOf'][1]['properties']['items']['$dynamicRef']['allOf'][0]:
    {'$schema': 'https://json-schema.org/draft/2020-12/schema',
     '$id': 'https://json-schema.org/draft/2020-12/meta/core',
     '$vocabulary': {'https://json-schema.org/draft/2020-12/vocab/core': True},
     '$dynamicAnchor': 'meta',
     'title': 'Core vocabulary meta-schema',
     'type': ['object', 'boolean'],
     'properties': {'$id': {'$ref': '#/$defs/uriReferenceString',
                            '$comment': 'Non-empty fragments not allowed.',
                            'pattern': '^[^#]*#?$'},
                    '$schema': {'$ref': '#/$defs/uriString'},
                    '$ref': {'$ref': '#/$defs/uriReferenceString'},
                    '$anchor': {'$ref': '#/$defs/anchorString'},
                    '$dynamicRef': {'$ref': '#/$defs/uriReferenceString'},
                    '$dynamicAnchor': {'$ref': '#/$defs/anchorString'},
                    '$vocabulary': {'type': 'object',
                                    'propertyNames': {'$ref': '#/$defs/uriString'},
                                    'additionalProperties': {'type': 'boolean'}},
                    '$comment': {'type': 'string'},
                    '$defs': {'type': 'object',
                              'additionalProperties': {'$dynamicRef': '#meta'}}},
     '$defs': {'anchorString': {'type': 'string',
                                'pattern': '^[A-Za-z_][-A-Za-z0-9._]*$'},
               'uriString': {'type': 'string', 'format': 'uri'},
               'uriReferenceString': {'type': 'string',
                                      'format': 'uri-reference'}}}

On schema['items']:
    [{'url': 'string'}]

2025-02-24 10:57:43,719 [Thread-10 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 10:57:58,397 [MainThread] INFO [root.__init__:68] ThreadedHTTPServer initialized
2025-02-24 10:57:58,758 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740423478758] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 10:57:58,759 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740423478758] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 10:57:58,763 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740423478758] Processing query with handler: NLWSHandler
2025-02-24 10:57:58,764 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740423478764] Starting query handling for site: nlws, query_id: 
2025-02-24 10:58:17,834 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.handle_query:202] [query_1740423478764] Error in handle_query: 'items'
2025-02-24 10:58:17,839 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.handle_query:203] [query_1740423478764] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 45, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 61, in synthesizeAnswer
    for item in response["items"]:
                ~~~~~~~~^^^^^^^^^
KeyError: 'items'

2025-02-24 10:58:17,840 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.do_GET:158] [req_1740423478758] Error handling request: 'items'
2025-02-24 10:58:17,845 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.do_GET:159] [req_1740423478758] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 150, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 45, in getRankedAnswers
    await self.synthesizeAnswer()
  File "/Users/guha/nlweb/c2/nlws.py", line 61, in synthesizeAnswer
    for item in response["items"]:
                ~~~~~~~~^^^^^^^^^
KeyError: 'items'

2025-02-24 10:58:17,845 [Thread-6 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 10:58:20,856 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740423500856] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 10:58:20,857 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740423500856] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 10:58:20,858 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740423500856] Processing query with handler: NLWSHandler
2025-02-24 10:58:20,860 [Thread-7 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740423500859] Starting query handling for site: nlws, query_id: 
2025-02-24 10:58:22,053 [Thread-7 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.454926 seconds
2025-02-24 11:00:54,988 [MainThread] INFO [root.__init__:68] ThreadedHTTPServer initialized
2025-02-24 11:00:55,731 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740423655731] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 11:00:55,732 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740423655731] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 11:00:55,734 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740423655731] Processing query with handler: NLWSHandler
2025-02-24 11:00:55,735 [Thread-5 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740423655735] Starting query handling for site: nlws, query_id: 
2025-02-24 11:01:13,984 [Thread-5 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740423655735] Query handling completed successfully
2025-02-24 11:01:14,013 [Thread-5 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:03:53,704 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740423833704] Received GET request for path: /html/nlws.html
2025-02-24 11:03:53,727 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740423833727] Received GET request for path: /html/streaming.js
2025-02-24 11:03:53,740 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740423833740] Received GET request for path: /favicon.ico
2025-02-24 11:03:58,014 [Thread-7 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:03:58,216 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740423838216] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 11:03:58,217 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740423838216] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 11:03:58,219 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740423838216] Processing query with handler: NLWSHandler
2025-02-24 11:03:58,220 [Thread-8 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740423838220] Starting query handling for site: nlws, query_id: 
2025-02-24 11:03:59,351 [Thread-8 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.471509 seconds
2025-02-24 11:04:25,348 [Thread-8 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740423838220] Query handling completed successfully
2025-02-24 11:04:25,367 [Thread-8 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:05:33,332 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740423933332] Received GET request for path: /html/nlws.html
2025-02-24 11:05:33,338 [Thread-6 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:05:33,345 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740423933345] Received GET request for path: /html/streaming.js
2025-02-24 11:05:33,352 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740423933352] Received GET request for path: /favicon.ico
2025-02-24 11:05:36,230 [Thread-10 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740423936230] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 11:05:36,231 [Thread-10 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740423936230] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 11:05:36,232 [Thread-10 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740423936230] Processing query with handler: NLWSHandler
2025-02-24 11:05:36,232 [Thread-10 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740423936232] Starting query handling for site: nlws, query_id: 
2025-02-24 11:05:36,979 [Thread-10 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.430109 seconds
2025-02-24 11:05:53,027 [Thread-10 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740423936232] Query handling completed successfully
2025-02-24 11:05:53,040 [Thread-10 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:14:34,394 [MainThread] INFO [root.__init__:68] ThreadedHTTPServer initialized
2025-02-24 11:14:36,691 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740424476691] Received GET request for path: /html/nlws.html
2025-02-24 11:14:36,715 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740424476715] Received GET request for path: /html/streaming.js
2025-02-24 11:14:36,741 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740424476741] Received GET request for path: /favicon.ico
2025-02-24 11:14:37,397 [Thread-6 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:14:39,626 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740424479626] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20fruit%20based%20dessert%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 11:14:39,626 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740424479626] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a fruit based dessert?'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 11:14:39,628 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740424479626] Processing query with handler: NLWSHandler
2025-02-24 11:14:39,628 [Thread-7 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740424479628] Starting query handling for site: nlws, query_id: 
2025-02-24 11:14:50,436 [Thread-7 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740424479628] Query handling completed successfully
2025-02-24 11:14:50,454 [Thread-7 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:15:16,850 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740424516850] Received GET request for path: /html/nlws.html
2025-02-24 11:15:16,853 [Thread-5 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:15:16,867 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740424516867] Received GET request for path: /favicon.ico
2025-02-24 11:15:42,388 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740424542388] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20baked%20dessert%3F%3F&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 11:15:42,390 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740424542388] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a baked dessert??'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 11:15:42,391 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740424542388] Processing query with handler: NLWSHandler
2025-02-24 11:15:42,391 [Thread-9 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740424542391] Starting query handling for site: nlws, query_id: 
2025-02-24 11:15:42,857 [Thread-9 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.436678 seconds
2025-02-24 11:15:55,215 [Thread-9 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740424542391] Query handling completed successfully
2025-02-24 11:15:55,231 [Thread-9 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:16:37,614 [MainThread] INFO [root.__init__:68] ThreadedHTTPServer initialized
2025-02-24 11:17:31,557 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740424651557] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20an%20asian%20rice%20based%20main%20course%20and%20a%20sorbet%20dessert.&site=nlws&model=gpt-4o-mini&prev=%5B%22I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20baked%20dessert%3F%3F%22%5D&item_to_remember=&context_url=
2025-02-24 11:17:31,560 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740424651557] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, an asian rice based main course and a sorbet dessert.'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['["I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a baked dessert??"]']}
2025-02-24 11:17:31,565 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740424651557] Processing query with handler: NLWSHandler
2025-02-24 11:17:31,567 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740424651567] Starting query handling for site: nlws, query_id: 
2025-02-24 11:17:52,315 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740424651567] Query handling completed successfully
2025-02-24 11:17:52,330 [Thread-6 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:23:22,520 [MainThread] INFO [root.__init__:68] ThreadedHTTPServer initialized
2025-02-24 11:23:24,247 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740425004247] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20an%20asian%20rice%20based%20main%20course%20and%20a%20sorbet%20dessert.&site=nlws&model=gpt-4o-mini&prev=%5B%22I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20baked%20dessert%3F%3F%22%2C%22I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20an%20asian%20rice%20based%20main%20course%20and%20a%20sorbet%20dessert.%22%5D&item_to_remember=&context_url=
2025-02-24 11:23:24,249 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740425004247] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, an asian rice based main course and a sorbet dessert.'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['["I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a baked dessert??","I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, an asian rice based main course and a sorbet dessert."]']}
2025-02-24 11:23:24,251 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740425004247] Processing query with handler: NLWSHandler
2025-02-24 11:23:24,251 [Thread-5 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740425004251] Starting query handling for site: nlws, query_id: 
2025-02-24 11:23:25,930 [Thread-5 (process_request_thread)] ERROR [StreamingHandler.handle_query:202] [query_1740425004251] Error in handle_query: name 'trim_json_hard' is not defined
2025-02-24 11:23:25,931 [Thread-5 (process_request_thread)] ERROR [StreamingHandler.handle_query:203] [query_1740425004251] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 45, in getRankedAnswers
    await asyncio.gather(*tasks)
  File "/Users/guha/nlweb/c2/nlws.py", line 50, in gatherItems
    description = trim_json_hard(json_str)
                  ^^^^^^^^^^^^^^
NameError: name 'trim_json_hard' is not defined

2025-02-24 11:23:25,931 [Thread-5 (process_request_thread)] ERROR [StreamingHandler.do_GET:158] [req_1740425004247] Error handling request: name 'trim_json_hard' is not defined
2025-02-24 11:23:25,932 [Thread-5 (process_request_thread)] ERROR [StreamingHandler.do_GET:159] [req_1740425004247] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 150, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 45, in getRankedAnswers
    await asyncio.gather(*tasks)
  File "/Users/guha/nlweb/c2/nlws.py", line 50, in gatherItems
    description = trim_json_hard(json_str)
                  ^^^^^^^^^^^^^^
NameError: name 'trim_json_hard' is not defined

2025-02-24 11:23:25,933 [Thread-5 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:23:28,939 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740425008939] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20an%20asian%20rice%20based%20main%20course%20and%20a%20sorbet%20dessert.&site=nlws&model=gpt-4o-mini&prev=%5B%22I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20baked%20dessert%3F%3F%22%2C%22I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20an%20asian%20rice%20based%20main%20course%20and%20a%20sorbet%20dessert.%22%5D&item_to_remember=&context_url=
2025-02-24 11:23:28,940 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740425008939] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, an asian rice based main course and a sorbet dessert.'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['["I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a baked dessert??","I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, an asian rice based main course and a sorbet dessert."]']}
2025-02-24 11:23:28,940 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740425008939] Processing query with handler: NLWSHandler
2025-02-24 11:23:28,941 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740425008941] Starting query handling for site: nlws, query_id: 
2025-02-24 11:23:28,953 [Thread-6 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.496405 seconds
2025-02-24 11:23:31,771 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.handle_query:202] [query_1740425008941] Error in handle_query: name 'trim_json_hard' is not defined
2025-02-24 11:23:31,772 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.handle_query:203] [query_1740425008941] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 45, in getRankedAnswers
    await asyncio.gather(*tasks)
  File "/Users/guha/nlweb/c2/nlws.py", line 50, in gatherItems
    description = trim_json_hard(json_str)
                  ^^^^^^^^^^^^^^
NameError: name 'trim_json_hard' is not defined

2025-02-24 11:23:31,772 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.do_GET:158] [req_1740425008939] Error handling request: name 'trim_json_hard' is not defined
2025-02-24 11:23:31,773 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.do_GET:159] [req_1740425008939] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 150, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 45, in getRankedAnswers
    await asyncio.gather(*tasks)
  File "/Users/guha/nlweb/c2/nlws.py", line 50, in gatherItems
    description = trim_json_hard(json_str)
                  ^^^^^^^^^^^^^^
NameError: name 'trim_json_hard' is not defined

2025-02-24 11:23:31,773 [Thread-6 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:23:34,780 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740425014780] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20an%20asian%20rice%20based%20main%20course%20and%20a%20sorbet%20dessert.&site=nlws&model=gpt-4o-mini&prev=%5B%22I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20baked%20dessert%3F%3F%22%2C%22I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20an%20asian%20rice%20based%20main%20course%20and%20a%20sorbet%20dessert.%22%5D&item_to_remember=&context_url=
2025-02-24 11:23:34,781 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740425014780] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, an asian rice based main course and a sorbet dessert.'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['["I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a baked dessert??","I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, an asian rice based main course and a sorbet dessert."]']}
2025-02-24 11:23:34,781 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740425014780] Processing query with handler: NLWSHandler
2025-02-24 11:23:34,782 [Thread-7 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740425014782] Starting query handling for site: nlws, query_id: 
2025-02-24 11:23:34,792 [Thread-7 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.463230 seconds
2025-02-24 11:23:37,312 [Thread-7 (process_request_thread)] ERROR [StreamingHandler.handle_query:202] [query_1740425014782] Error in handle_query: name 'trim_json_hard' is not defined
2025-02-24 11:23:37,313 [Thread-7 (process_request_thread)] ERROR [StreamingHandler.handle_query:203] [query_1740425014782] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 45, in getRankedAnswers
    await asyncio.gather(*tasks)
  File "/Users/guha/nlweb/c2/nlws.py", line 50, in gatherItems
    description = trim_json_hard(json_str)
                  ^^^^^^^^^^^^^^
NameError: name 'trim_json_hard' is not defined

2025-02-24 11:23:37,313 [Thread-7 (process_request_thread)] ERROR [StreamingHandler.do_GET:158] [req_1740425014780] Error handling request: name 'trim_json_hard' is not defined
2025-02-24 11:23:37,313 [Thread-7 (process_request_thread)] ERROR [StreamingHandler.do_GET:159] [req_1740425014780] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 150, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 45, in getRankedAnswers
    await asyncio.gather(*tasks)
  File "/Users/guha/nlweb/c2/nlws.py", line 50, in gatherItems
    description = trim_json_hard(json_str)
                  ^^^^^^^^^^^^^^
NameError: name 'trim_json_hard' is not defined

2025-02-24 11:23:37,313 [Thread-7 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:23:40,321 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740425020321] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20an%20asian%20rice%20based%20main%20course%20and%20a%20sorbet%20dessert.&site=nlws&model=gpt-4o-mini&prev=%5B%22I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20a%20rice%20based%20main%20course%20and%20a%20baked%20dessert%3F%3F%22%2C%22I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20an%20asian%20rice%20based%20main%20course%20and%20a%20sorbet%20dessert.%22%5D&item_to_remember=&context_url=
2025-02-24 11:23:40,322 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740425020321] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, an asian rice based main course and a sorbet dessert.'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['["I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, a rice based main course and a baked dessert??","I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, an asian rice based main course and a sorbet dessert."]']}
2025-02-24 11:23:40,322 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740425020321] Processing query with handler: NLWSHandler
2025-02-24 11:23:40,323 [Thread-8 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740425020323] Starting query handling for site: nlws, query_id: 
2025-02-24 11:23:40,330 [Thread-8 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.398867 seconds
2025-02-24 11:24:06,961 [MainThread] INFO [root.__init__:68] ThreadedHTTPServer initialized
2025-02-24 11:24:08,003 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740425048003] Received GET request for path: /html/nlws.html
2025-02-24 11:24:08,023 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740425048023] Received GET request for path: /html/streaming.js
2025-02-24 11:24:08,048 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740425048048] Received GET request for path: /favicon.ico
2025-02-24 11:24:10,483 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740425050483] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20an%20asian%20rice%20based%20main%20course%20and%20a%20sorbet%20dessert.&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 11:24:10,484 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740425050483] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, an asian rice based main course and a sorbet dessert.'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 11:24:10,485 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740425050483] Processing query with handler: NLWSHandler
2025-02-24 11:24:10,486 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740425050486] Starting query handling for site: nlws, query_id: 
2025-02-24 11:24:11,127 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.handle_query:202] [query_1740425050486] Error in handle_query: name 'trim_recipe_hard' is not defined
2025-02-24 11:24:11,130 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.handle_query:203] [query_1740425050486] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 45, in getRankedAnswers
    await asyncio.gather(*tasks)
  File "/Users/guha/nlweb/c2/nlws.py", line 50, in gatherItems
    description = trim_json_hard(json_str)
  File "/Users/guha/nlweb/c2/trim.py", line 28, in trim_json_hard
    return trim_recipe_hard(obj)
           ^^^^^^^^^^^^^^^^
NameError: name 'trim_recipe_hard' is not defined. Did you mean: 'trim_recipe'?

2025-02-24 11:24:11,130 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.do_GET:158] [req_1740425050483] Error handling request: name 'trim_recipe_hard' is not defined
2025-02-24 11:24:11,131 [Thread-6 (process_request_thread)] ERROR [StreamingHandler.do_GET:159] [req_1740425050483] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 150, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 45, in getRankedAnswers
    await asyncio.gather(*tasks)
  File "/Users/guha/nlweb/c2/nlws.py", line 50, in gatherItems
    description = trim_json_hard(json_str)
  File "/Users/guha/nlweb/c2/trim.py", line 28, in trim_json_hard
    return trim_recipe_hard(obj)
           ^^^^^^^^^^^^^^^^
NameError: name 'trim_recipe_hard' is not defined. Did you mean: 'trim_recipe'?

2025-02-24 11:24:11,131 [Thread-6 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:24:14,138 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740425054138] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20an%20asian%20rice%20based%20main%20course%20and%20a%20sorbet%20dessert.&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 11:24:14,138 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740425054138] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, an asian rice based main course and a sorbet dessert.'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 11:24:14,139 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740425054138] Processing query with handler: NLWSHandler
2025-02-24 11:24:14,139 [Thread-7 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740425054139] Starting query handling for site: nlws, query_id: 
2025-02-24 11:24:14,898 [Thread-7 (process_request_thread)] ERROR [StreamingHandler.handle_query:202] [query_1740425054139] Error in handle_query: name 'trim_recipe_hard' is not defined
2025-02-24 11:24:14,898 [Thread-7 (process_request_thread)] ERROR [StreamingHandler.handle_query:203] [query_1740425054139] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 45, in getRankedAnswers
    await asyncio.gather(*tasks)
  File "/Users/guha/nlweb/c2/nlws.py", line 50, in gatherItems
    description = trim_json_hard(json_str)
  File "/Users/guha/nlweb/c2/trim.py", line 28, in trim_json_hard
    return trim_recipe_hard(obj)
           ^^^^^^^^^^^^^^^^
NameError: name 'trim_recipe_hard' is not defined. Did you mean: 'trim_recipe'?

2025-02-24 11:24:14,898 [Thread-7 (process_request_thread)] ERROR [StreamingHandler.do_GET:158] [req_1740425054138] Error handling request: name 'trim_recipe_hard' is not defined
2025-02-24 11:24:14,899 [Thread-7 (process_request_thread)] ERROR [StreamingHandler.do_GET:159] [req_1740425054138] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 150, in do_GET
    loop.run_until_complete(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        self.handle_query(site, query, prev, model, query_id, context_url)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 721, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/WebServerHandler.py", line 196, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/nlws.py", line 45, in getRankedAnswers
    await asyncio.gather(*tasks)
  File "/Users/guha/nlweb/c2/nlws.py", line 50, in gatherItems
    description = trim_json_hard(json_str)
  File "/Users/guha/nlweb/c2/trim.py", line 28, in trim_json_hard
    return trim_recipe_hard(obj)
           ^^^^^^^^^^^^^^^^
NameError: name 'trim_recipe_hard' is not defined. Did you mean: 'trim_recipe'?

2025-02-24 11:24:14,899 [Thread-7 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:25:18,452 [MainThread] INFO [root.__init__:68] ThreadedHTTPServer initialized
2025-02-24 11:25:21,016 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740425121016] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20an%20asian%20rice%20based%20main%20course%20and%20a%20sorbet%20dessert.&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 11:25:21,018 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740425121016] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, an asian rice based main course and a sorbet dessert.'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 11:25:21,022 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740425121016] Processing query with handler: NLWSHandler
2025-02-24 11:25:21,022 [Thread-5 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740425121022] Starting query handling for site: nlws, query_id: 
2025-02-24 11:25:31,733 [Thread-5 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740425121022] Query handling completed successfully
2025-02-24 11:25:31,760 [Thread-5 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:26:33,147 [MainThread] INFO [root.__init__:68] ThreadedHTTPServer initialized
2025-02-24 11:26:40,064 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740425200064] Received GET request for path: /html/nlws.html
2025-02-24 11:26:40,095 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740425200092] Received GET request for path: /html/streaming.js
2025-02-24 11:26:40,102 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740425200102] Received GET request for path: /favicon.ico
2025-02-24 11:26:42,377 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740425202377] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20an%20asian%20rice%20based%20main%20course%20and%20a%20sorbet%20dessert.&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 11:26:42,378 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740425202377] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, an asian rice based main course and a sorbet dessert.'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 11:26:42,380 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740425202377] Processing query with handler: NLWSHandler
2025-02-24 11:26:42,380 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740425202380] Starting query handling for site: nlws, query_id: 
2025-02-24 11:26:58,514 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740425202380] Query handling completed successfully
2025-02-24 11:26:58,528 [Thread-6 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:29:53,038 [MainThread] INFO [root.__init__:68] ThreadedHTTPServer initialized
2025-02-24 11:30:26,287 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740425426287] Received GET request for path: /html/nlws.html
2025-02-24 11:30:26,327 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740425426327] Received GET request for path: /html/streaming.js
2025-02-24 11:30:26,361 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740425426361] Received GET request for path: /favicon.ico
2025-02-24 11:30:29,443 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740425429443] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20an%20asian%20rice%20based%20main%20course%20and%20a%20sorbet%20dessert.&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 11:30:29,444 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740425429443] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, an asian rice based main course and a sorbet dessert.'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 11:30:29,447 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740425429443] Processing query with handler: NLWSHandler
2025-02-24 11:30:29,447 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740425429447] Starting query handling for site: nlws, query_id: 
2025-02-24 11:30:47,382 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740425429447] Query handling completed successfully
2025-02-24 11:30:47,395 [Thread-6 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:32:03,547 [MainThread] INFO [root.__init__:68] ThreadedHTTPServer initialized
2025-02-24 11:32:35,445 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740425555445] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20an%20asian%20main%20course%20and%20a%20sorbet%20dessert.&site=nlws&model=gpt-4o-mini&prev=%5B%22I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20friends%20who%20like%20fusion%20cooking.%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20an%20asian%20rice%20based%20main%20course%20and%20a%20sorbet%20dessert.%22%5D&item_to_remember=&context_url=
2025-02-24 11:32:35,448 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740425555445] Received parameters: {'query': ['I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, an asian main course and a sorbet dessert.'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['["I am trying to prepare a three course dinner for friends who like fusion cooking. Can you suggest a menu with a salad, an asian rice based main course and a sorbet dessert."]']}
2025-02-24 11:32:35,450 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740425555445] Processing query with handler: NLWSHandler
2025-02-24 11:32:35,451 [Thread-5 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740425555451] Starting query handling for site: nlws, query_id: 
2025-02-24 11:32:47,557 [Thread-5 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740425555451] Query handling completed successfully
2025-02-24 11:32:47,572 [Thread-5 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:33:10,784 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740425590783] Received GET request for path: /html/nlws.html
2025-02-24 11:33:10,807 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740425590807] Received GET request for path: /html/streaming.js
2025-02-24 11:33:10,819 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740425590818] Received GET request for path: /favicon.ico
2025-02-24 11:34:07,008 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740425647008] Received GET request for path: /?query=I%20am%20trying%20to%20prepare%20a%20three%20course%20dinner%20for%20frieI%20am%20planning%20the%20menu%20for%20a%20summer%20outdoor%20dinner%20get%20together%20with%20some%20friends.%20%20Can%20you%20suggest%20a%20menu%20with%20a%20salad%2C%20an%20asian%20rice%20based%20main%20course%20and%20a%20sorbet%20dessert.&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 11:34:07,009 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740425647008] Received parameters: {'query': ['I am trying to prepare a three course dinner for frieI am planning the menu for a summer outdoor dinner get together with some friends.  Can you suggest a menu with a salad, an asian rice based main course and a sorbet dessert.'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 11:34:07,010 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740425647008] Processing query with handler: NLWSHandler
2025-02-24 11:34:07,010 [Thread-7 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740425647010] Starting query handling for site: nlws, query_id: 
2025-02-24 11:34:07,652 [Thread-7 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.482704 seconds
2025-02-24 11:34:19,717 [Thread-7 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740425647010] Query handling completed successfully
2025-02-24 11:34:19,732 [Thread-7 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:35:32,311 [Thread-6 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:42:14,747 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740426134747] Received GET request for path: /html/streaming.js
2025-02-24 11:42:14,765 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740426134765] Received GET request for path: /favicon.ico
2025-02-24 11:42:15,052 [Thread-9 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:42:25,696 [Thread-10 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740426145696] Received GET request for path: /html/nlws.html
2025-02-24 11:42:25,711 [Thread-10 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740426145710] Received GET request for path: /favicon.ico
2025-02-24 11:42:30,005 [Thread-11 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740426150005] Received GET request for path: /?query=I%20am%20trying%20to%20make%20a%20snack%20for%20my%20kids.%20Something%20they%20can%20put%20into%20their%20backpack.%20Should%20be%20vegetarian&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 11:42:30,005 [Thread-11 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740426150005] Received parameters: {'query': ['I am trying to make a snack for my kids. Something they can put into their backpack. Should be vegetarian'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 11:42:30,007 [Thread-11 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740426150005] Processing query with handler: NLWSHandler
2025-02-24 11:42:30,007 [Thread-11 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740426150007] Starting query handling for site: nlws, query_id: 
2025-02-24 11:42:31,096 [Thread-11 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.418681 seconds
2025-02-24 11:42:42,023 [Thread-11 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740426150007] Query handling completed successfully
2025-02-24 11:42:42,038 [Thread-11 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:43:25,710 [Thread-8 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:45:11,938 [MainThread] INFO [root.__init__:68] ThreadedHTTPServer initialized
2025-02-24 11:45:19,113 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740426319113] Received GET request for path: /?query=I%20am%20trying%20to%20make%20a%20snack%20for%20my%20kids.%20Something%20they%20can%20put%20into%20their%20backpack.%20Should%20be%20vegetarian&site=nlws&model=gpt-4o-mini&prev=%5B%22I%20am%20trying%20to%20make%20a%20snack%20for%20my%20kids.%20Something%20they%20can%20put%20into%20their%20backpack.%20Should%20be%20vegetarian%22%5D&item_to_remember=&context_url=
2025-02-24 11:45:19,114 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740426319113] Received parameters: {'query': ['I am trying to make a snack for my kids. Something they can put into their backpack. Should be vegetarian'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['["I am trying to make a snack for my kids. Something they can put into their backpack. Should be vegetarian"]']}
2025-02-24 11:45:19,116 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740426319113] Processing query with handler: NLWSHandler
2025-02-24 11:45:19,116 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740426319116] Starting query handling for site: nlws, query_id: 
2025-02-24 11:45:30,019 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740426319116] Query handling completed successfully
2025-02-24 11:45:30,024 [Thread-6 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:45:47,266 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740426347266] Received GET request for path: /html/nlws.html
2025-02-24 11:45:47,287 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740426347287] Received GET request for path: /favicon.ico
2025-02-24 11:45:55,449 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740426355449] Received GET request for path: /?query=I%20am%20trying%20to%20make%20a%20snack%20for%20my%20kids.%20Something%20they%20can%20put%20into%20their%20backpack.%20Should%20be%20vegetarian&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 11:45:55,451 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740426355449] Received parameters: {'query': ['I am trying to make a snack for my kids. Something they can put into their backpack. Should be vegetarian'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 11:45:55,451 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740426355449] Processing query with handler: NLWSHandler
2025-02-24 11:45:55,453 [Thread-8 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740426355453] Starting query handling for site: nlws, query_id: 
2025-02-24 11:45:57,065 [Thread-8 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.437048 seconds
2025-02-24 11:46:10,887 [Thread-8 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740426355453] Query handling completed successfully
2025-02-24 11:46:10,891 [Thread-8 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:47:02,591 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740426422591] Received GET request for path: /html/nlws.html
2025-02-24 11:47:02,599 [Thread-7 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:47:02,607 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740426422607] Received GET request for path: /html/streaming.js
2025-02-24 11:47:02,613 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740426422613] Received GET request for path: /favicon.ico
2025-02-24 11:47:15,382 [MainThread] INFO [root.__init__:68] ThreadedHTTPServer initialized
2025-02-24 11:47:16,168 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740426436168] Received GET request for path: /?query=I%20am%20trying%20to%20make%20a%20snack%20for%20my%20kids.%20Something%20they%20can%20put%20into%20their%20backpack.%20Should%20be%20vegetarian&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 11:47:16,170 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740426436168] Received parameters: {'query': ['I am trying to make a snack for my kids. Something they can put into their backpack. Should be vegetarian'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 11:47:16,173 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740426436168] Processing query with handler: NLWSHandler
2025-02-24 11:47:16,174 [Thread-5 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740426436174] Starting query handling for site: nlws, query_id: 
2025-02-24 11:47:29,011 [Thread-5 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740426436174] Query handling completed successfully
2025-02-24 11:47:29,028 [Thread-5 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:48:57,323 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740426537323] Received GET request for path: /?query=Give%20me%20a%20menu%20for%20a%203%20course%2C%20informal%20dinner.%20I%20need%20a%20salad%2C%20an%20asian%20main%20and%20light%20dessert.%20I%20like%20fusion%20recipes&site=nlws&model=gpt-4o-mini&prev=%5B%22I%20am%20trying%20to%20make%20a%20snack%20for%20my%20kids.%20Something%20they%20can%20put%20into%20their%20backpack.%20Should%20be%20vegetarian%22%5D&item_to_remember=&context_url=
2025-02-24 11:48:57,324 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740426537323] Received parameters: {'query': ['Give me a menu for a 3 course, informal dinner. I need a salad, an asian main and light dessert. I like fusion recipes'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['["I am trying to make a snack for my kids. Something they can put into their backpack. Should be vegetarian"]']}
2025-02-24 11:48:57,325 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740426537323] Processing query with handler: NLWSHandler
2025-02-24 11:48:57,326 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740426537326] Starting query handling for site: nlws, query_id: 
2025-02-24 11:48:57,331 [Thread-6 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.395070 seconds
2025-02-24 11:49:16,019 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740426537326] Query handling completed successfully
2025-02-24 11:49:16,028 [Thread-6 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:49:43,813 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740426583813] Received GET request for path: /html/nlws.html
2025-02-24 11:49:43,831 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740426583831] Received GET request for path: /html/streaming.js
2025-02-24 11:49:43,838 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740426583838] Received GET request for path: /favicon.ico
2025-02-24 11:50:21,048 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740426621048] Received GET request for path: /?query=Give%20me%20a%20menu%20for%20a%203%20course%20fusion%20dinner%20that%20would%20be%20good%20for%20a%20cold%20winter%20night.%20I%20need%20a%20salad%2C%20an%20asian%20main%20and%20hot%20dessert.&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 11:50:21,049 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740426621048] Received parameters: {'query': ['Give me a menu for a 3 course fusion dinner that would be good for a cold winter night. I need a salad, an asian main and hot dessert.'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 11:50:21,050 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740426621048] Processing query with handler: NLWSHandler
2025-02-24 11:50:21,050 [Thread-8 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740426621050] Starting query handling for site: nlws, query_id: 
2025-02-24 11:50:21,429 [Thread-8 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.488113 seconds
2025-02-24 11:50:33,882 [Thread-8 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740426621050] Query handling completed successfully
2025-02-24 11:50:33,891 [Thread-8 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:50:52,985 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740426652985] Received GET request for path: /html/nlws.html
2025-02-24 11:50:52,993 [Thread-7 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:50:53,004 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740426653004] Received GET request for path: /favicon.ico
2025-02-24 11:51:24,838 [Thread-10 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740426684838] Received GET request for path: /?query=Give%20me%20a%20menu%20for%20a%203%20course%20fusion%20dinner%20that%20would%20be%20good%20for%20an%20informal%20get%20together.%20I%20need%20a%20salad%2C%20an%20asian%20main%20and%20sorbet%20dessert.&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 11:51:24,838 [Thread-10 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740426684838] Received parameters: {'query': ['Give me a menu for a 3 course fusion dinner that would be good for an informal get together. I need a salad, an asian main and sorbet dessert.'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 11:51:24,839 [Thread-10 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740426684838] Processing query with handler: NLWSHandler
2025-02-24 11:51:24,840 [Thread-10 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740426684840] Starting query handling for site: nlws, query_id: 
2025-02-24 11:51:25,620 [Thread-10 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.398347 seconds
2025-02-24 11:51:37,738 [Thread-10 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740426684840] Query handling completed successfully
2025-02-24 11:51:37,747 [Thread-10 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:55:11,264 [MainThread] INFO [root.__init__:68] ThreadedHTTPServer initialized
2025-02-24 11:55:13,688 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740426913688] Received GET request for path: /html/nlws.html
2025-02-24 11:55:13,713 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740426913713] Received GET request for path: /html/streaming.js
2025-02-24 11:55:13,722 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740426913722] Received GET request for path: /favicon.ico
2025-02-24 11:55:15,949 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740426915949] Received GET request for path: /?query=Give%20me%20a%20menu%20for%20a%203%20course%20fusion%20dinner%20that%20would%20be%20good%20for%20an%20informal%20get%20together.%20I%20need%20a%20salad%2C%20an%20asian%20main%20and%20sorbet%20dessert.&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 11:55:15,951 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740426915949] Received parameters: {'query': ['Give me a menu for a 3 course fusion dinner that would be good for an informal get together. I need a salad, an asian main and sorbet dessert.'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 11:55:15,953 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740426915949] Processing query with handler: NLWSHandler
2025-02-24 11:55:15,953 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740426915953] Starting query handling for site: nlws, query_id: 
2025-02-24 11:55:27,207 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740426915953] Query handling completed successfully
2025-02-24 11:55:27,223 [Thread-6 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:55:53,861 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740426953861] Received GET request for path: /html/nlws.html
2025-02-24 11:55:53,867 [Thread-5 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 11:55:53,878 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740426953878] Received GET request for path: /favicon.ico
2025-02-24 11:56:00,548 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740426960548] Received GET request for path: /?query=Give%20me%20a%20menu%20for%20a%203%20course%20fusion%20dinner%20that%20would%20be%20good%20for%20an%20informal%20summer%20get%20together.%20I%20need%20a%20salad%2C%20an%20asian%20main%20and%20sorbet%20dessert.&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 11:56:00,549 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740426960548] Received parameters: {'query': ['Give me a menu for a 3 course fusion dinner that would be good for an informal summer get together. I need a salad, an asian main and sorbet dessert.'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 11:56:00,550 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740426960548] Processing query with handler: NLWSHandler
2025-02-24 11:56:00,550 [Thread-8 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740426960550] Starting query handling for site: nlws, query_id: 
2025-02-24 11:56:01,040 [Thread-8 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.451626 seconds
2025-02-24 11:56:12,306 [Thread-8 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740426960550] Query handling completed successfully
2025-02-24 11:56:12,317 [Thread-8 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 12:48:05,089 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740430085089] Received GET request for path: /html/nlws.html
2025-02-24 12:48:05,099 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740430085099] Received GET request for path: /html/streaming.js
2025-02-24 12:48:05,117 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740430085117] Received GET request for path: /favicon.ico
2025-02-24 12:49:09,710 [Thread-10 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 13:34:03,425 [Thread-11 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740432843425] Received GET request for path: /html/str_chat.html
2025-02-24 13:34:03,442 [Thread-11 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740432843442] Received GET request for path: /html/streaming.js
2025-02-24 13:34:03,448 [Thread-11 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740432843447] Received GET request for path: /html/clear.jpeg
2025-02-24 13:34:03,448 [Thread-12 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740432843448] Received GET request for path: /html/debug.png
2025-02-24 13:34:03,466 [Thread-12 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740432843466] Received GET request for path: /favicon.ico
2025-02-24 13:34:08,155 [Thread-11 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 13:34:18,058 [Thread-13 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740432858058] Received GET request for path: /?query=who%20are%20the%20actors%20in%20the%20Star%20Wars%20movies&site=imdb&model=auto&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 13:34:18,059 [Thread-13 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740432858058] Received parameters: {'query': ['who are the actors in the Star Wars movies'], 'site': ['imdb'], 'model': ['auto'], 'prev': ['[]']}
2025-02-24 13:34:18,062 [Thread-13 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740432858058] Processing query with handler: GraphStructureHandler
2025-02-24 13:34:18,063 [Thread-13 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740432858063] Starting query handling for site: imdb, query_id: 
2025-02-24 13:34:18,078 [Thread-13 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.446264 seconds
2025-02-24 13:34:19,811 [Thread-13 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:61] item_type in graph: Movie
2025-02-24 13:34:24,860 [Thread-13 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740432858063] Query handling completed successfully
2025-02-24 13:34:24,861 [Thread-13 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 14:14:32,683 [Thread-7 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 14:16:22,066 [Thread-14 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740435382066] Received GET request for path: /html/streaming.js
2025-02-24 14:16:22,093 [Thread-14 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740435382093] Received GET request for path: /favicon.ico
2025-02-24 14:16:26,598 [Thread-14 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 14:17:26,441 [Thread-15 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740435446441] Received GET request for path: /favicon.ico
2025-02-24 14:18:00,608 [Thread-12 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 14:18:00,612 [Thread-15 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 14:18:00,614 [Thread-9 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 15:17:33,639 [Thread-16 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740439053639] Received GET request for path: /html/str_chat.html
2025-02-24 15:17:33,650 [Thread-16 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740439053650] Received GET request for path: /html/streaming.js
2025-02-24 15:17:33,675 [Thread-16 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740439053675] Received GET request for path: /favicon.ico
2025-02-24 15:17:38,113 [Thread-17 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 15:18:02,122 [Thread-18 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740439082122] Received GET request for path: /?query=three%20bedroom%20house%20costing%20less%20than%204%20million&site=zillow&model=auto&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 15:18:02,124 [Thread-18 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740439082122] Received parameters: {'query': ['three bedroom house costing less than 4 million'], 'site': ['zillow'], 'model': ['auto'], 'prev': ['[]']}
2025-02-24 15:18:02,127 [Thread-18 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740439082122] Processing query with handler: LocationSensitiveHandler
2025-02-24 15:18:02,128 [Thread-18 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740439082128] Starting query handling for site: zillow, query_id: 
2025-02-24 15:18:02,138 [Thread-18 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.386433 seconds
2025-02-24 15:18:03,102 [Thread-18 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:34] location_known: False
2025-02-24 15:18:03,103 [Thread-18 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740439082128] Query handling completed successfully
2025-02-24 15:18:03,107 [Thread-18 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 15:18:24,520 [Thread-19 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740439104520] Received GET request for path: /?query=Palo%20Alto&site=zillow&model=auto&prev=%5B%22three%20bedroom%20house%20costing%20less%20than%204%20million%22%5D&item_to_remember=&context_url=
2025-02-24 15:18:24,520 [Thread-19 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740439104520] Received parameters: {'query': ['Palo Alto'], 'site': ['zillow'], 'model': ['auto'], 'prev': ['["three bedroom house costing less than 4 million"]']}
2025-02-24 15:18:24,521 [Thread-19 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740439104520] Processing query with handler: LocationSensitiveHandler
2025-02-24 15:18:24,523 [Thread-19 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740439104523] Starting query handling for site: zillow, query_id: 
2025-02-24 15:18:24,528 [Thread-19 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.491991 seconds
2025-02-24 15:18:26,467 [Thread-19 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:34] location_known: True
2025-02-24 15:18:28,135 [Thread-19 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:34] location_known: True
2025-02-24 15:18:30,566 [Thread-20 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740439110566] Received GET request for path: /html/info.png
2025-02-24 15:18:33,124 [Thread-20 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 15:19:33,323 [Thread-19 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.430344 seconds
2025-02-24 15:19:37,186 [Thread-19 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740439104523] Query handling completed successfully
2025-02-24 15:19:37,188 [Thread-19 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 15:19:57,709 [Thread-21 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740439197709] Received GET request for path: /?query=give%20me%20movies%20about%20food%2C%20eating%20and%20cooking.%20Preferably%20asian.%20Perhaps%20set%20in%20a%20family%20context&site=imdb&model=auto&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 15:19:57,709 [Thread-21 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740439197709] Received parameters: {'query': ['give me movies about food, eating and cooking. Preferably asian. Perhaps set in a family context'], 'site': ['imdb'], 'model': ['auto'], 'prev': ['[]']}
2025-02-24 15:19:57,709 [Thread-21 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740439197709] Processing query with handler: GraphStructureHandler
2025-02-24 15:19:57,710 [Thread-21 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740439197710] Starting query handling for site: imdb, query_id: 
2025-02-24 15:19:57,716 [Thread-21 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.425196 seconds
2025-02-24 15:19:59,597 [Thread-21 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:61] item_type in graph: Movie
2025-02-24 15:20:00,547 [Thread-21 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:61] item_type in graph: Movie
2025-02-24 15:20:05,370 [Thread-21 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740439197710] Query handling completed successfully
2025-02-24 15:20:05,382 [Thread-21 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 15:20:20,335 [Thread-22 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740439220335] Received GET request for path: /?query=who%20are%20the%20actors%20in%20the%20star%20wars%20movies&site=imdb&model=auto&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 15:20:20,336 [Thread-22 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740439220335] Received parameters: {'query': ['who are the actors in the star wars movies'], 'site': ['imdb'], 'model': ['auto'], 'prev': ['[]']}
2025-02-24 15:20:20,337 [Thread-22 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740439220335] Processing query with handler: GraphStructureHandler
2025-02-24 15:20:20,337 [Thread-22 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740439220337] Starting query handling for site: imdb, query_id: 
2025-02-24 15:20:20,347 [Thread-22 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.415780 seconds
2025-02-24 15:20:21,942 [Thread-22 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:61] item_type in graph: Movie
2025-02-24 15:20:25,810 [Thread-22 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740439220337] Query handling completed successfully
2025-02-24 15:20:25,812 [Thread-22 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 15:33:37,531 [Thread-23 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740440017531] Received GET request for path: /?query=Give%20me%20a%20menu%20for%20a%203%20course%20fusion%20dinner%20that%20would%20be%20good%20for%20an%20informal%20summer%20get%20together.%20I%20need%20a%20salad%2C%20an%20asian%20main%20and%20sorbet%20dessert.&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 15:33:37,533 [Thread-23 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740440017531] Received parameters: {'query': ['Give me a menu for a 3 course fusion dinner that would be good for an informal summer get together. I need a salad, an asian main and sorbet dessert.'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-24 15:33:37,534 [Thread-23 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740440017531] Processing query with handler: NLWSHandler
2025-02-24 15:33:37,534 [Thread-23 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740440017534] Starting query handling for site: nlws, query_id: 
2025-02-24 15:33:38,289 [Thread-23 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.426663 seconds
2025-02-24 15:33:47,972 [Thread-23 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740440017534] Query handling completed successfully
2025-02-24 15:33:47,988 [Thread-23 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 16:45:27,135 [Thread-24 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740444327135] Received GET request for path: /html/streaming.js
2025-02-24 16:45:27,161 [Thread-24 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740444327161] Received GET request for path: /favicon.ico
2025-02-24 16:45:46,099 [Thread-25 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740444346099] Received GET request for path: /?query=give%20me%20papers%20on%20the%20use%20of%20large%20language%20models%20for%20health%20care&site=neurips&model=auto&prev=%5B%5D&item_to_remember=&context_url=
2025-02-24 16:45:46,099 [Thread-25 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740444346099] Received parameters: {'query': ['give me papers on the use of large language models for health care'], 'site': ['neurips'], 'model': ['auto'], 'prev': ['[]']}
2025-02-24 16:45:46,101 [Thread-25 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740444346099] Processing query with handler: BaseNLWebHandler
2025-02-24 16:45:46,102 [Thread-25 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740444346102] Starting query handling for site: neurips, query_id: 
2025-02-24 16:45:46,733 [Thread-25 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.422349 seconds
2025-02-24 16:45:53,098 [Thread-25 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740444346102] Query handling completed successfully
2025-02-24 16:45:53,115 [Thread-25 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 17:00:21,378 [Thread-24 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-24 17:00:21,392 [Thread-16 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-25 07:09:12,551 [Thread-26 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740496152551] Received GET request for path: /html/streaming.js
2025-02-25 07:09:12,561 [Thread-26 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740496152561] Received GET request for path: /html/clear.jpeg
2025-02-25 07:09:12,573 [Thread-26 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740496152573] Received GET request for path: /favicon.ico
2025-02-25 07:09:15,036 [Thread-27 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-25 07:10:17,811 [Thread-26 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-25 19:15:05,284 [Thread-28 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740539705283] Received GET request for path: /html/str_chat.html
2025-02-25 19:15:05,317 [Thread-28 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740539705317] Received GET request for path: /html/streaming.js
2025-02-25 19:15:05,323 [Thread-28 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740539705323] Received GET request for path: /html/debug.png
2025-02-25 19:15:05,663 [Thread-28 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-25 19:15:13,996 [Thread-29 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740539713996] Received GET request for path: /html/nlws.html
2025-02-25 19:15:14,067 [Thread-29 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740539714067] Received GET request for path: /favicon.ico
2025-02-25 19:15:15,665 [Thread-30 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-25 19:17:22,478 [Thread-31 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740539842478] Received GET request for path: /?query=Give%20me%20a%20menu%20for%20a%203%20course%20fusion%20dinner%20that%20would%20be%20good%20for%20an%20informal%20summer%20get%20together.%20I%20need%20a%20salad%2C%20an%20asian%20main%20and%20sorbet%20dessert.&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-25 19:17:22,480 [Thread-31 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740539842478] Received parameters: {'query': ['Give me a menu for a 3 course fusion dinner that would be good for an informal summer get together. I need a salad, an asian main and sorbet dessert.'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-25 19:17:22,483 [Thread-31 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740539842478] Processing query with handler: NLWSHandler
2025-02-25 19:17:22,483 [Thread-31 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740539842483] Starting query handling for site: nlws, query_id: 
2025-02-25 19:17:26,247 [Thread-31 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.436611 seconds
2025-02-25 19:17:41,144 [Thread-31 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740539842483] Query handling completed successfully
2025-02-25 19:17:41,157 [Thread-32 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740539861157] Received GET request for path: /html/info.png
2025-02-25 19:17:41,164 [Thread-31 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-25 19:17:45,695 [Thread-32 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-25 19:19:23,259 [Thread-33 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740539963259] Received GET request for path: /favicon.ico
2025-02-25 19:19:38,896 [Thread-34 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740539978896] Received GET request for path: /?query=I%20like%20the%20movie%20Johnnie%20English.%20What%20are%20other%20movies%20like%20that&site=imdb&model=auto&prev=%5B%5D&item_to_remember=&context_url=
2025-02-25 19:19:38,897 [Thread-34 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740539978896] Received parameters: {'query': ['I like the movie Johnnie English. What are other movies like that'], 'site': ['imdb'], 'model': ['auto'], 'prev': ['[]']}
2025-02-25 19:19:38,900 [Thread-34 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740539978896] Processing query with handler: GraphStructureHandler
2025-02-25 19:19:38,900 [Thread-34 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740539978900] Starting query handling for site: imdb, query_id: 
2025-02-25 19:19:38,911 [Thread-34 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.412562 seconds
2025-02-25 19:19:40,346 [Thread-34 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:61] item_type in graph: Movie
2025-02-25 19:19:41,381 [Thread-34 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:61] item_type in graph: Movie
2025-02-25 19:19:48,238 [Thread-34 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740539978900] Query handling completed successfully
2025-02-25 19:19:48,255 [Thread-34 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-26 06:44:15,916 [Thread-33 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-26 12:13:56,279 [Thread-35 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740600836279] Received GET request for path: /html/streaming.js
2025-02-26 12:13:56,929 [Thread-35 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740600836929] Received GET request for path: /favicon.ico
2025-02-26 12:14:18,611 [Thread-36 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740600858611] Received GET request for path: /?query=give%20me%20a%20home%20for%20three%20kids%20and%20a%20dog%2C%20costing%20less%20than%203%20million%2C%20would%20be%20good%20to%20have%20a%20pool&site=zillow&model=auto&prev=%5B%5D&item_to_remember=&context_url=
2025-02-26 12:14:18,613 [Thread-36 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740600858611] Received parameters: {'query': ['give me a home for three kids and a dog, costing less than 3 million, would be good to have a pool'], 'site': ['zillow'], 'model': ['auto'], 'prev': ['[]']}
2025-02-26 12:14:18,616 [Thread-36 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740600858611] Processing query with handler: LocationSensitiveHandler
2025-02-26 12:14:18,617 [Thread-36 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740600858617] Starting query handling for site: zillow, query_id: 
2025-02-26 12:14:18,630 [Thread-36 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.426634 seconds
2025-02-26 12:14:20,580 [Thread-36 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:34] location_known: False
2025-02-26 12:14:20,581 [Thread-36 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740600858617] Query handling completed successfully
2025-02-26 12:14:20,583 [Thread-36 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-26 12:14:31,361 [Thread-37 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740600871361] Received GET request for path: /?query=Sunnyvale&site=zillow&model=auto&prev=%5B%22give%20me%20a%20home%20for%20three%20kids%20and%20a%20dog%2C%20costing%20less%20than%203%20million%2C%20would%20be%20good%20to%20have%20a%20pool%22%5D&item_to_remember=&context_url=
2025-02-26 12:14:31,362 [Thread-37 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740600871361] Received parameters: {'query': ['Sunnyvale'], 'site': ['zillow'], 'model': ['auto'], 'prev': ['["give me a home for three kids and a dog, costing less than 3 million, would be good to have a pool"]']}
2025-02-26 12:14:31,362 [Thread-37 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740600871361] Processing query with handler: LocationSensitiveHandler
2025-02-26 12:14:31,363 [Thread-37 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740600871363] Starting query handling for site: zillow, query_id: 
2025-02-26 12:14:31,370 [Thread-37 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.397541 seconds
2025-02-26 12:14:34,023 [Thread-37 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:34] location_known: True
2025-02-26 12:14:36,600 [Thread-37 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:34] location_known: True
2025-02-26 12:14:44,309 [Thread-37 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740600871363] Query handling completed successfully
2025-02-26 12:14:44,313 [Thread-37 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-26 12:15:26,406 [Thread-38 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740600926406] Received GET request for path: /?query=give%20me%20some%20healthy%20central%20american%20breakfast%20items&site=latam_recipes&model=auto&prev=%5B%5D&item_to_remember=&context_url=
2025-02-26 12:15:26,408 [Thread-38 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740600926406] Received parameters: {'query': ['give me some healthy central american breakfast items'], 'site': ['latam_recipes'], 'model': ['auto'], 'prev': ['[]']}
2025-02-26 12:15:26,409 [Thread-38 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740600926406] Processing query with handler: ItemTypeSensitiveRedirectHandler
2025-02-26 12:15:26,409 [Thread-38 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740600926409] Starting query handling for site: latam_recipes, query_id: 
2025-02-26 12:15:26,421 [Thread-38 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.410329 seconds
2025-02-26 12:15:27,559 [Thread-38 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:22] item_type in latam: Recipe
2025-02-26 12:15:31,363 [Thread-38 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740600926409] Query handling completed successfully
2025-02-26 12:15:31,367 [Thread-38 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-26 12:15:45,026 [Thread-39 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740600945026] Received GET request for path: /?query=are%20there%20restaurants%20near%20mountain%20view%20where%20I%20can%20these%3F&site=latam_recipes&model=auto&prev=%5B%22give%20me%20some%20healthy%20central%20american%20breakfast%20items%22%5D&item_to_remember=&context_url=
2025-02-26 12:15:45,028 [Thread-39 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740600945026] Received parameters: {'query': ['are there restaurants near mountain view where I can these?'], 'site': ['latam_recipes'], 'model': ['auto'], 'prev': ['["give me some healthy central american breakfast items"]']}
2025-02-26 12:15:45,029 [Thread-39 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740600945026] Processing query with handler: ItemTypeSensitiveRedirectHandler
2025-02-26 12:15:45,029 [Thread-39 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740600945029] Starting query handling for site: latam_recipes, query_id: 
2025-02-26 12:15:45,038 [Thread-39 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.382488 seconds
2025-02-26 12:15:46,155 [Thread-39 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:22] item_type in latam: Restaurant
2025-02-26 12:15:46,155 [Thread-39 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:28] Setting site to ['tripadvisor']
2025-02-26 12:15:50,681 [Thread-39 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740600945029] Query handling completed successfully
2025-02-26 12:15:50,687 [Thread-39 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-26 12:18:01,677 [Thread-40 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740601081676] Received GET request for path: /html/nlwebsearch.html
2025-02-26 12:18:02,489 [Thread-40 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740601082489] Received GET request for path: /favicon.ico
2025-02-26 12:18:08,502 [Thread-41 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740601088502] Received GET request for path: /?query=I%20am%20trying%20to%20make%20a%20snack%20for%20my%20kids.%20Something%20they%20can%20put%20into%20their%20backpack.%20Should%20be%20vegetarian&site=all&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-26 12:18:08,502 [Thread-41 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740601088502] Received parameters: {'query': ['I am trying to make a snack for my kids. Something they can put into their backpack. Should be vegetarian'], 'site': ['all'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-26 12:18:08,504 [Thread-41 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740601088502] Processing query with handler: BaseNLWebHandler
2025-02-26 12:18:08,504 [Thread-41 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740601088504] Starting query handling for site: all, query_id: 
2025-02-26 12:18:10,334 [Thread-41 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.429436 seconds
2025-02-26 12:18:12,847 [Thread-41 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740601088504] Query handling completed successfully
2025-02-26 12:18:12,852 [Thread-41 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-26 12:19:02,491 [Thread-35 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-26 12:22:25,059 [Thread-42 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740601345059] Received GET request for path: /favicon.ico
2025-02-26 12:22:57,746 [Thread-43 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740601377746] Received GET request for path: /?query=give%20me%20movies%20that%20are%20about%20AI%20that%20would%20be%20good%20for%20small%20kids%2C%20that%20portray%20AI%20in%20a%20good%20light&site=imdb&model=auto&prev=%5B%5D&item_to_remember=&context_url=
2025-02-26 12:22:57,747 [Thread-43 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740601377746] Received parameters: {'query': ['give me movies that are about AI that would be good for small kids, that portray AI in a good light'], 'site': ['imdb'], 'model': ['auto'], 'prev': ['[]']}
2025-02-26 12:22:57,751 [Thread-43 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740601377746] Processing query with handler: GraphStructureHandler
2025-02-26 12:22:57,752 [Thread-43 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740601377752] Starting query handling for site: imdb, query_id: 
2025-02-26 12:22:57,766 [Thread-43 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.485516 seconds
2025-02-26 12:23:00,258 [Thread-43 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:61] item_type in graph: Movie
2025-02-26 12:23:02,009 [Thread-43 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:61] item_type in graph: Movie
2025-02-26 12:23:07,242 [Thread-43 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740601377752] Query handling completed successfully
2025-02-26 12:23:07,247 [Thread-43 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-26 12:23:57,717 [Thread-44 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740601437717] Received GET request for path: /?query=Historic%20impact%20of%20tariffs%20on%20different%20parts%20of%20the%20economy&site=npr%20podcasts&model=auto&prev=%5B%5D&item_to_remember=&context_url=
2025-02-26 12:23:57,720 [Thread-44 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740601437717] Received parameters: {'query': ['Historic impact of tariffs on different parts of the economy'], 'site': ['npr podcasts'], 'model': ['auto'], 'prev': ['[]']}
2025-02-26 12:23:57,722 [Thread-44 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740601437717] Processing query with handler: BaseNLWebHandler
2025-02-26 12:23:57,722 [Thread-44 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740601437722] Starting query handling for site: npr podcasts, query_id: 
2025-02-26 12:23:58,876 [Thread-44 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.421776 seconds
2025-02-26 12:24:06,109 [Thread-44 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740601437722] Query handling completed successfully
2025-02-26 12:24:06,123 [Thread-44 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-26 12:38:36,407 [Thread-45 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740602316407] Received GET request for path: /?query=what%20are%20some%20interesting%20delicacies%20from%20Trichi&site=hebbarskitchen&model=auto&prev=%5B%5D&item_to_remember=&context_url=
2025-02-26 12:38:36,412 [Thread-45 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740602316407] Received parameters: {'query': ['what are some interesting delicacies from Trichi'], 'site': ['hebbarskitchen'], 'model': ['auto'], 'prev': ['[]']}
2025-02-26 12:38:36,429 [Thread-45 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740602316407] Processing query with handler: RecipeHandler
2025-02-26 12:38:36,430 [Thread-45 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740602316430] Starting query handling for site: hebbarskitchen, query_id: 
2025-02-26 12:38:36,440 [Thread-45 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.433879 seconds
2025-02-26 12:38:44,746 [Thread-45 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740602316430] Query handling completed successfully
2025-02-26 12:38:44,752 [Thread-45 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-26 12:39:36,131 [Thread-46 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740602376131] Received GET request for path: /favicon.ico
2025-02-26 12:40:11,188 [Thread-47 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740602411188] Received GET request for path: /?query=What%20are%20some%20delicacies%20from%20Bangalore&site=hebbarskitchen&model=auto&prev=%5B%22what%20are%20some%20interesting%20delicacies%20from%20Trichi%22%5D&item_to_remember=&context_url=
2025-02-26 12:40:11,190 [Thread-47 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740602411188] Received parameters: {'query': ['What are some delicacies from Bangalore'], 'site': ['hebbarskitchen'], 'model': ['auto'], 'prev': ['["what are some interesting delicacies from Trichi"]']}
2025-02-26 12:40:11,191 [Thread-47 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740602411188] Processing query with handler: RecipeHandler
2025-02-26 12:40:11,192 [Thread-47 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740602411192] Starting query handling for site: hebbarskitchen, query_id: 
2025-02-26 12:40:11,205 [Thread-47 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.402916 seconds
2025-02-26 12:40:23,565 [Thread-47 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740602411192] Query handling completed successfully
2025-02-26 12:40:23,574 [Thread-47 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-26 12:40:40,047 [Thread-48 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740602440047] Received GET request for path: /favicon.ico
2025-02-26 12:40:55,726 [Thread-49 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740602455726] Received GET request for path: /?query=give%20me%20something%20healthier&site=hebbarskitchen&model=auto&prev=%5B%22what%20are%20some%20interesting%20delicacies%20from%20Trichi%22%2C%22What%20are%20some%20delicacies%20from%20Bangalore%22%5D&item_to_remember=&context_url=
2025-02-26 12:40:55,727 [Thread-49 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740602455726] Received parameters: {'query': ['give me something healthier'], 'site': ['hebbarskitchen'], 'model': ['auto'], 'prev': ['["what are some interesting delicacies from Trichi","What are some delicacies from Bangalore"]']}
2025-02-26 12:40:55,728 [Thread-49 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740602455726] Processing query with handler: RecipeHandler
2025-02-26 12:40:55,728 [Thread-49 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740602455728] Starting query handling for site: hebbarskitchen, query_id: 
2025-02-26 12:40:55,739 [Thread-49 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.414826 seconds
2025-02-26 12:41:05,827 [Thread-49 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740602455728] Query handling completed successfully
2025-02-26 12:41:05,837 [Thread-49 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-26 13:14:25,987 [Thread-40 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-26 13:14:25,987 [Thread-46 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-26 13:14:25,988 [Thread-48 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-26 13:14:25,988 [Thread-42 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-27 07:37:01,473 [Thread-29 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-27 16:28:33,487 [MainThread] INFO [root.__init__:68] ThreadedHTTPServer initialized
2025-02-27 16:34:29,343 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740702869343] Received GET request for path: /html/str_chat.html
2025-02-27 16:34:29,352 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740702869352] Received GET request for path: /html/streaming.js
2025-02-27 16:34:29,358 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740702869358] Received GET request for path: /html/debug.png
2025-02-27 16:34:29,358 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740702869358] Received GET request for path: /html/clear.jpeg
2025-02-27 16:34:29,368 [Thread-5 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740702869368] Received GET request for path: /favicon.ico
2025-02-27 16:34:50,469 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740702890469] Received GET request for path: /?query=give%20me%20a%20home%20for%20my%20three%20kids%20and%20a%20dog&site=zillow&model=auto&prev=%5B%5D&item_to_remember=&context_url=
2025-02-27 16:34:50,470 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740702890469] Received parameters: {'query': ['give me a home for my three kids and a dog'], 'site': ['zillow'], 'model': ['auto'], 'prev': ['[]']}
2025-02-27 16:34:50,473 [Thread-6 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740702890469] Processing query with handler: LocationSensitiveHandler
2025-02-27 16:34:50,474 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740702890474] Starting query handling for site: zillow, query_id: 
2025-02-27 16:34:51,248 [Thread-6 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:34] location_known: False
2025-02-27 16:34:51,249 [Thread-6 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740702890474] Query handling completed successfully
2025-02-27 16:34:51,254 [Thread-6 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-27 16:35:03,042 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740702903042] Received GET request for path: /?query=Menlo%20Park&site=zillow&model=auto&prev=%5B%22give%20me%20a%20home%20for%20my%20three%20kids%20and%20a%20dog%22%5D&item_to_remember=&context_url=
2025-02-27 16:35:03,043 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740702903042] Received parameters: {'query': ['Menlo Park'], 'site': ['zillow'], 'model': ['auto'], 'prev': ['["give me a home for my three kids and a dog"]']}
2025-02-27 16:35:03,044 [Thread-7 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740702903042] Processing query with handler: LocationSensitiveHandler
2025-02-27 16:35:03,045 [Thread-7 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740702903045] Starting query handling for site: zillow, query_id: 
2025-02-27 16:35:03,052 [Thread-7 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.390549 seconds
2025-02-27 16:35:05,368 [Thread-7 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:34] location_known: True
2025-02-27 16:35:07,070 [Thread-7 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:34] location_known: True
2025-02-27 16:35:09,545 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740702909545] Received GET request for path: /html/info.png
2025-02-27 16:35:12,335 [Thread-7 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740702903045] Query handling completed successfully
2025-02-27 16:35:12,353 [Thread-7 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-27 16:36:42,999 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740703002998] Received GET request for path: /?query=show%20me%20the%20actors%20in%20the%20blade%20runner%20movies&site=imdb&model=auto&prev=%5B%5D&item_to_remember=&context_url=
2025-02-27 16:36:43,000 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740703002998] Received parameters: {'query': ['show me the actors in the blade runner movies'], 'site': ['imdb'], 'model': ['auto'], 'prev': ['[]']}
2025-02-27 16:36:43,002 [Thread-8 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740703002998] Processing query with handler: GraphStructureHandler
2025-02-27 16:36:43,003 [Thread-8 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740703003003] Starting query handling for site: imdb, query_id: 
2025-02-27 16:36:43,012 [Thread-8 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.489221 seconds
2025-02-27 16:36:44,624 [Thread-8 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:61] item_type in graph: Movie
2025-02-27 16:36:49,247 [Thread-8 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740703003003] Query handling completed successfully
2025-02-27 16:36:49,251 [Thread-8 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-27 16:37:41,928 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740703061928] Received GET request for path: /?query=give%20me%20healthy%20fiber%20rich%20central%20american%20breakfasts&site=latam_recipes&model=auto&prev=%5B%5D&item_to_remember=&context_url=
2025-02-27 16:37:41,929 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740703061928] Received parameters: {'query': ['give me healthy fiber rich central american breakfasts'], 'site': ['latam_recipes'], 'model': ['auto'], 'prev': ['[]']}
2025-02-27 16:37:41,930 [Thread-9 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740703061928] Processing query with handler: ItemTypeSensitiveRedirectHandler
2025-02-27 16:37:41,930 [Thread-9 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740703061930] Starting query handling for site: latam_recipes, query_id: 
2025-02-27 16:37:41,940 [Thread-9 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.436002 seconds
2025-02-27 16:37:42,917 [Thread-9 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:22] item_type in latam: Recipe
2025-02-27 16:37:51,338 [Thread-9 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740703061930] Query handling completed successfully
2025-02-27 16:37:51,351 [Thread-9 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-27 16:37:58,373 [Thread-10 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740703078373] Received GET request for path: /?query=are%20there%20restaurants%20near%20mountain%20view%20where%20I%20can%20get%20these&site=latam_recipes&model=auto&prev=%5B%22give%20me%20healthy%20fiber%20rich%20central%20american%20breakfasts%22%5D&item_to_remember=&context_url=
2025-02-27 16:37:58,373 [Thread-10 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740703078373] Received parameters: {'query': ['are there restaurants near mountain view where I can get these'], 'site': ['latam_recipes'], 'model': ['auto'], 'prev': ['["give me healthy fiber rich central american breakfasts"]']}
2025-02-27 16:37:58,374 [Thread-10 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740703078373] Processing query with handler: ItemTypeSensitiveRedirectHandler
2025-02-27 16:37:58,374 [Thread-10 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740703078374] Starting query handling for site: latam_recipes, query_id: 
2025-02-27 16:37:58,380 [Thread-10 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.485834 seconds
2025-02-27 16:37:59,523 [Thread-10 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:22] item_type in latam: Restaurant
2025-02-27 16:37:59,523 [Thread-10 (process_request_thread)] INFO [StreamingHandler.analyzeQuery:28] Setting site to ['tripadvisor']
2025-02-27 16:38:10,386 [Thread-10 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740703078374] Query handling completed successfully
2025-02-27 16:38:10,398 [Thread-10 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-27 16:39:11,523 [Thread-11 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740703151523] Received GET request for path: /?query=give%20me%20podcasts%20that%20analyse%20the%20historical%20impact%20of%20tariffs%20on%20different%20sectors%20of%20the%20economy&site=npr%20podcasts&model=auto&prev=%5B%5D&item_to_remember=&context_url=
2025-02-27 16:39:11,524 [Thread-11 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740703151523] Received parameters: {'query': ['give me podcasts that analyse the historical impact of tariffs on different sectors of the economy'], 'site': ['npr podcasts'], 'model': ['auto'], 'prev': ['[]']}
2025-02-27 16:39:11,525 [Thread-11 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740703151523] Processing query with handler: BaseNLWebHandler
2025-02-27 16:39:11,525 [Thread-11 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740703151525] Starting query handling for site: npr podcasts, query_id: 
2025-02-27 16:39:12,694 [Thread-11 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.453388 seconds
2025-02-27 16:39:19,481 [Thread-11 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740703151525] Query handling completed successfully
2025-02-27 16:39:19,491 [Thread-11 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-27 16:40:18,717 [Thread-12 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740703218717] Received GET request for path: /html/nlwebsearch.html
2025-02-27 16:40:18,726 [Thread-12 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740703218726] Received GET request for path: /html/streaming.js
2025-02-27 16:40:18,739 [Thread-12 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740703218739] Received GET request for path: /favicon.ico
2025-02-27 16:40:23,158 [Thread-13 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740703223158] Received GET request for path: /?query=I%20am%20trying%20to%20make%20a%20snack%20for%20my%20kids.%20Something%20they%20can%20put%20into%20their%20backpack.%20Should%20be%20vegetarian&site=all&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-27 16:40:23,159 [Thread-13 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740703223158] Received parameters: {'query': ['I am trying to make a snack for my kids. Something they can put into their backpack. Should be vegetarian'], 'site': ['all'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-27 16:40:23,160 [Thread-13 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740703223158] Processing query with handler: BaseNLWebHandler
2025-02-27 16:40:23,160 [Thread-13 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740703223160] Starting query handling for site: all, query_id: 
2025-02-27 16:40:23,886 [Thread-13 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.483341 seconds
2025-02-27 16:40:28,245 [Thread-13 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740703223160] Query handling completed successfully
2025-02-27 16:40:28,264 [Thread-13 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-27 16:41:01,440 [Thread-14 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740703261440] Received GET request for path: /html/nlws.html
2025-02-27 16:41:01,458 [Thread-14 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740703261458] Received GET request for path: /favicon.ico
2025-02-27 16:41:44,034 [Thread-15 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740703304034] Received GET request for path: /?query=Give%20me%20a%20menu%20for%20a%203%20course%20fusion%20dinner%20that%20would%20be%20good%20for%20an%20informal%20summer%20get%20together.%20I%20need%20a%20salad%2C%20an%20asian%20main%20and%20sorbet%20dessert.&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-27 16:41:44,036 [Thread-15 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740703304034] Received parameters: {'query': ['Give me a menu for a 3 course fusion dinner that would be good for an informal summer get together. I need a salad, an asian main and sorbet dessert.'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-27 16:41:44,037 [Thread-15 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740703304034] Processing query with handler: NLWSHandler
2025-02-27 16:41:44,038 [Thread-15 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740703304038] Starting query handling for site: nlws, query_id: 
2025-02-27 16:41:44,513 [Thread-15 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.409840 seconds
2025-02-27 16:41:58,974 [Thread-15 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740703304038] Query handling completed successfully
2025-02-27 16:41:58,982 [Thread-15 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-27 16:42:01,455 [Thread-12 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-27 17:53:15,877 [Thread-16 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740707595877] Received GET request for path: /html/str_chat.html
2025-02-27 17:53:15,884 [Thread-16 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740707595884] Received GET request for path: /html/streaming.js
2025-02-27 17:53:15,889 [Thread-16 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740707595889] Received GET request for path: /html/clear.jpeg
2025-02-27 17:53:15,890 [Thread-17 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740707595890] Received GET request for path: /html/debug.png
2025-02-27 17:53:23,990 [Thread-17 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740707603990] Received GET request for path: /html/nlws.html
2025-02-27 17:53:28,707 [Thread-17 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740707608707] Received GET request for path: /?query=Give%20me%20a%20menu%20for%20a%203%20course%20fusion%20dinner%20that%20would%20be%20good%20for%20an%20informal%20summer%20get%20together.%20I%20need%20a%20salad%2C%20an%20asian%20main%20and%20sorbet%20dessert.&site=nlws&model=gpt-4o-mini&prev=%5B%5D&item_to_remember=&context_url=
2025-02-27 17:53:28,708 [Thread-17 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740707608707] Received parameters: {'query': ['Give me a menu for a 3 course fusion dinner that would be good for an informal summer get together. I need a salad, an asian main and sorbet dessert.'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['[]']}
2025-02-27 17:53:28,710 [Thread-17 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740707608707] Processing query with handler: NLWSHandler
2025-02-27 17:53:28,711 [Thread-17 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740707608711] Starting query handling for site: nlws, query_id: 
2025-02-27 17:53:29,998 [Thread-17 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.496121 seconds
2025-02-27 17:53:40,311 [Thread-17 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740707608711] Query handling completed successfully
2025-02-27 17:53:40,323 [Thread-16 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740707620323] Received GET request for path: /html/info.png
2025-02-27 17:53:40,329 [Thread-17 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-27 17:53:50,982 [Thread-18 (process_request_thread)] INFO [StreamingHandler.do_GET:108] [req_1740707630982] Received GET request for path: /?query=Give%20me%20a%20menu%20for%20a%203%20course%20fusion%20dinner%20that%20would%20be%20good%20for%20an%20informal%20summer%20get%20together.%20I%20need%20a%20salad%2C%20an%20asian%20main%20and%20sorbet%20dessert.&site=nlws&model=gpt-4o-mini&prev=%5B%22Give%20me%20a%20menu%20for%20a%203%20course%20fusion%20dinner%20that%20would%20be%20good%20for%20an%20informal%20summer%20get%20together.%20I%20need%20a%20salad%2C%20an%20asian%20main%20and%20sorbet%20dessert.%22%5D&item_to_remember=&context_url=
2025-02-27 17:53:50,983 [Thread-18 (process_request_thread)] INFO [StreamingHandler.do_GET:129] [req_1740707630982] Received parameters: {'query': ['Give me a menu for a 3 course fusion dinner that would be good for an informal summer get together. I need a salad, an asian main and sorbet dessert.'], 'site': ['nlws'], 'model': ['gpt-4o-mini'], 'prev': ['["Give me a menu for a 3 course fusion dinner that would be good for an informal summer get together. I need a salad, an asian main and sorbet dessert."]']}
2025-02-27 17:53:50,984 [Thread-18 (process_request_thread)] INFO [StreamingHandler.do_GET:149] [req_1740707630982] Processing query with handler: NLWSHandler
2025-02-27 17:53:50,984 [Thread-18 (process_request_thread)] INFO [StreamingHandler.handle_query:187] [query_1740707630984] Starting query handling for site: nlws, query_id: 
2025-02-27 17:53:50,991 [Thread-18 (process_request_thread)] INFO [openai._base_client._retry_request:1666] Retrying request to /chat/completions in 0.386894 seconds
2025-02-27 17:54:14,947 [Thread-18 (process_request_thread)] INFO [StreamingHandler.handle_query:200] [query_1740707630984] Query handling completed successfully
2025-02-27 17:54:14,957 [Thread-18 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-27 17:59:21,487 [Thread-16 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-27 22:03:03,913 [Thread-5 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-27 22:03:03,911 [Thread-14 (process_request_thread)] INFO [StreamingHandler.__init__:79] StreamingHandler initialized with directory: /Users/guha/nlweb/c2
2025-02-28 15:47:56,340 [MainThread] INFO [HandleRequest.do_GET:68] [req_1740786476340] Received GET request for path: /
2025-02-28 15:47:56,341 [MainThread] ERROR [HandleRequest.do_GET:104] [req_1740786476340] Error handling request: memoryview: a bytes-like object is required, not 'dict'
2025-02-28 15:47:56,344 [MainThread] ERROR [HandleRequest.do_GET:105] [req_1740786476340] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/StreamingWrapper.py", line 72, in do_GET
    params = parse_qs(self.query_params)
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/parse.py", line 730, in parse_qs
    pairs = parse_qsl(qs, keep_blank_values, strict_parsing,
                      encoding=encoding, errors=errors,
                      max_num_fields=max_num_fields, separator=separator)
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/parse.py", line 784, in parse_qsl
    qs = bytes(memoryview(qs))
               ~~~~~~~~~~^^^^
TypeError: memoryview: a bytes-like object is required, not 'dict'

2025-02-28 15:47:56,345 [MainThread] CRITICAL [HandleRequest.do_GET:124] [req_1740786476340] Critical error during error handling: handle_client.<locals>.send_response() missing 1 required positional argument: 'response_headers'
2025-02-28 15:47:59,351 [MainThread] INFO [HandleRequest.do_GET:68] [req_1740786479351] Received GET request for path: /
2025-02-28 15:47:59,352 [MainThread] ERROR [HandleRequest.do_GET:104] [req_1740786479351] Error handling request: memoryview: a bytes-like object is required, not 'dict'
2025-02-28 15:47:59,353 [MainThread] ERROR [HandleRequest.do_GET:105] [req_1740786479351] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/StreamingWrapper.py", line 72, in do_GET
    params = parse_qs(self.query_params)
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/parse.py", line 730, in parse_qs
    pairs = parse_qsl(qs, keep_blank_values, strict_parsing,
                      encoding=encoding, errors=errors,
                      max_num_fields=max_num_fields, separator=separator)
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/parse.py", line 784, in parse_qsl
    qs = bytes(memoryview(qs))
               ~~~~~~~~~~^^^^
TypeError: memoryview: a bytes-like object is required, not 'dict'

2025-02-28 15:47:59,354 [MainThread] CRITICAL [HandleRequest.do_GET:124] [req_1740786479351] Critical error during error handling: handle_client.<locals>.send_response() missing 1 required positional argument: 'response_headers'
2025-02-28 15:48:02,359 [MainThread] INFO [HandleRequest.do_GET:68] [req_1740786482359] Received GET request for path: /
2025-02-28 15:48:02,359 [MainThread] ERROR [HandleRequest.do_GET:104] [req_1740786482359] Error handling request: memoryview: a bytes-like object is required, not 'dict'
2025-02-28 15:48:02,361 [MainThread] ERROR [HandleRequest.do_GET:105] [req_1740786482359] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/StreamingWrapper.py", line 72, in do_GET
    params = parse_qs(self.query_params)
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/parse.py", line 730, in parse_qs
    pairs = parse_qsl(qs, keep_blank_values, strict_parsing,
                      encoding=encoding, errors=errors,
                      max_num_fields=max_num_fields, separator=separator)
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/parse.py", line 784, in parse_qsl
    qs = bytes(memoryview(qs))
               ~~~~~~~~~~^^^^
TypeError: memoryview: a bytes-like object is required, not 'dict'

2025-02-28 15:48:02,361 [MainThread] CRITICAL [HandleRequest.do_GET:124] [req_1740786482359] Critical error during error handling: handle_client.<locals>.send_response() missing 1 required positional argument: 'response_headers'
2025-02-28 15:48:53,437 [MainThread] INFO [HandleRequest.do_GET:68] [req_1740786533437] Received GET request for path: /
2025-02-28 15:48:53,438 [MainThread] ERROR [HandleRequest.do_GET:104] [req_1740786533437] Error handling request: memoryview: a bytes-like object is required, not 'dict'
2025-02-28 15:48:53,441 [MainThread] ERROR [HandleRequest.do_GET:105] [req_1740786533437] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/StreamingWrapper.py", line 72, in do_GET
    params = parse_qs(self.query_params)
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/parse.py", line 730, in parse_qs
    pairs = parse_qsl(qs, keep_blank_values, strict_parsing,
                      encoding=encoding, errors=errors,
                      max_num_fields=max_num_fields, separator=separator)
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/parse.py", line 784, in parse_qsl
    qs = bytes(memoryview(qs))
               ~~~~~~~~~~^^^^
TypeError: memoryview: a bytes-like object is required, not 'dict'

2025-02-28 15:48:53,441 [MainThread] CRITICAL [HandleRequest.do_GET:124] [req_1740786533437] Critical error during error handling: handle_client.<locals>.send_response() missing 1 required positional argument: 'response_headers'
2025-02-28 15:48:56,447 [MainThread] INFO [HandleRequest.do_GET:68] [req_1740786536447] Received GET request for path: /
2025-02-28 15:48:56,448 [MainThread] ERROR [HandleRequest.do_GET:104] [req_1740786536447] Error handling request: memoryview: a bytes-like object is required, not 'dict'
2025-02-28 15:48:56,449 [MainThread] ERROR [HandleRequest.do_GET:105] [req_1740786536447] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/StreamingWrapper.py", line 72, in do_GET
    params = parse_qs(self.query_params)
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/parse.py", line 730, in parse_qs
    pairs = parse_qsl(qs, keep_blank_values, strict_parsing,
                      encoding=encoding, errors=errors,
                      max_num_fields=max_num_fields, separator=separator)
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/parse.py", line 784, in parse_qsl
    qs = bytes(memoryview(qs))
               ~~~~~~~~~~^^^^
TypeError: memoryview: a bytes-like object is required, not 'dict'

2025-02-28 15:48:56,449 [MainThread] CRITICAL [HandleRequest.do_GET:124] [req_1740786536447] Critical error during error handling: handle_client.<locals>.send_response() missing 1 required positional argument: 'response_headers'
2025-02-28 15:52:53,804 [MainThread] INFO [HandleRequest.do_GET:68] [req_1740786773804] Received GET request for path: /
2025-02-28 15:52:53,806 [MainThread] ERROR [HandleRequest.do_GET:104] [req_1740786773804] Error handling request: memoryview: a bytes-like object is required, not 'dict'
2025-02-28 15:52:53,809 [MainThread] ERROR [HandleRequest.do_GET:105] [req_1740786773804] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/StreamingWrapper.py", line 72, in do_GET
    params = parse_qs(self.query_params)
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/parse.py", line 730, in parse_qs
    pairs = parse_qsl(qs, keep_blank_values, strict_parsing,
                      encoding=encoding, errors=errors,
                      max_num_fields=max_num_fields, separator=separator)
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/parse.py", line 784, in parse_qsl
    qs = bytes(memoryview(qs))
               ~~~~~~~~~~^^^^
TypeError: memoryview: a bytes-like object is required, not 'dict'

2025-02-28 15:52:53,809 [MainThread] CRITICAL [HandleRequest.do_GET:124] [req_1740786773804] Critical error during error handling: handle_client.<locals>.send_response() missing 1 required positional argument: 'response_headers'
2025-02-28 15:52:56,816 [MainThread] INFO [HandleRequest.do_GET:68] [req_1740786776816] Received GET request for path: /
2025-02-28 15:52:56,816 [MainThread] ERROR [HandleRequest.do_GET:104] [req_1740786776816] Error handling request: memoryview: a bytes-like object is required, not 'dict'
2025-02-28 15:52:56,818 [MainThread] ERROR [HandleRequest.do_GET:105] [req_1740786776816] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/StreamingWrapper.py", line 72, in do_GET
    params = parse_qs(self.query_params)
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/parse.py", line 730, in parse_qs
    pairs = parse_qsl(qs, keep_blank_values, strict_parsing,
                      encoding=encoding, errors=errors,
                      max_num_fields=max_num_fields, separator=separator)
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/parse.py", line 784, in parse_qsl
    qs = bytes(memoryview(qs))
               ~~~~~~~~~~^^^^
TypeError: memoryview: a bytes-like object is required, not 'dict'

2025-02-28 15:52:56,818 [MainThread] CRITICAL [HandleRequest.do_GET:124] [req_1740786776816] Critical error during error handling: handle_client.<locals>.send_response() missing 1 required positional argument: 'response_headers'
2025-02-28 15:53:59,908 [MainThread] INFO [HandleRequest.do_GET:69] [req_1740786839908] Received GET request for path: /
2025-02-28 15:53:59,909 [MainThread] ERROR [HandleRequest.do_GET:105] [req_1740786839908] Error handling request: memoryview: a bytes-like object is required, not 'dict'
2025-02-28 15:53:59,912 [MainThread] ERROR [HandleRequest.do_GET:106] [req_1740786839908] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/StreamingWrapper.py", line 73, in do_GET
    params = parse_qs(self.query_params)
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/parse.py", line 730, in parse_qs
    pairs = parse_qsl(qs, keep_blank_values, strict_parsing,
                      encoding=encoding, errors=errors,
                      max_num_fields=max_num_fields, separator=separator)
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/parse.py", line 784, in parse_qsl
    qs = bytes(memoryview(qs))
               ~~~~~~~~~~^^^^
TypeError: memoryview: a bytes-like object is required, not 'dict'

2025-02-28 15:53:59,913 [MainThread] CRITICAL [HandleRequest.do_GET:125] [req_1740786839908] Critical error during error handling: handle_client.<locals>.send_response() missing 1 required positional argument: 'response_headers'
2025-02-28 15:56:15,110 [MainThread] INFO [HandleRequest.do_GET:68] [req_1740786975110] Received GET request for path: /
2025-02-28 15:56:15,112 [MainThread] ERROR [HandleRequest.do_GET:102] [req_1740786975110] Error handling request: name 'params' is not defined
2025-02-28 15:56:15,114 [MainThread] ERROR [HandleRequest.do_GET:103] [req_1740786975110] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/StreamingWrapper.py", line 73, in do_GET
    self.logger.info(f"[{request_id}] Received parameters: {params}")
                                                            ^^^^^^
NameError: name 'params' is not defined

2025-02-28 15:56:15,114 [MainThread] CRITICAL [HandleRequest.do_GET:122] [req_1740786975110] Critical error during error handling: handle_client.<locals>.send_response() missing 1 required positional argument: 'response_headers'
2025-02-28 15:56:18,120 [MainThread] INFO [HandleRequest.do_GET:68] [req_1740786978120] Received GET request for path: /
2025-02-28 15:56:18,121 [MainThread] ERROR [HandleRequest.do_GET:102] [req_1740786978120] Error handling request: name 'params' is not defined
2025-02-28 15:56:18,122 [MainThread] ERROR [HandleRequest.do_GET:103] [req_1740786978120] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/StreamingWrapper.py", line 73, in do_GET
    self.logger.info(f"[{request_id}] Received parameters: {params}")
                                                            ^^^^^^
NameError: name 'params' is not defined

2025-02-28 15:56:18,122 [MainThread] CRITICAL [HandleRequest.do_GET:122] [req_1740786978120] Critical error during error handling: handle_client.<locals>.send_response() missing 1 required positional argument: 'response_headers'
2025-02-28 15:56:45,162 [MainThread] INFO [HandleRequest.do_GET:68] [req_1740787005162] Received GET request for path: /
2025-02-28 15:56:45,163 [MainThread] INFO [HandleRequest.do_GET:73] [req_1740787005162] Received parameters: {'query': 'food movies', 'site': 'imdb', 'model': 'auto', 'prev': '[]'}
2025-02-28 15:56:45,163 [MainThread] ERROR [HandleRequest.do_GET:102] [req_1740787005162] Error handling request: handle_client.<locals>.send_response() missing 1 required positional argument: 'response_headers'
2025-02-28 15:56:45,165 [MainThread] ERROR [HandleRequest.do_GET:103] [req_1740787005162] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/StreamingWrapper.py", line 84, in do_GET
    self._start_sse_response()
    ~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/StreamingWrapper.py", line 186, in _start_sse_response
    self.send_response(200)
    ~~~~~~~~~~~~~~~~~~^^^^^
TypeError: handle_client.<locals>.send_response() missing 1 required positional argument: 'response_headers'

2025-02-28 15:56:45,165 [MainThread] CRITICAL [HandleRequest.do_GET:122] [req_1740787005162] Critical error during error handling: handle_client.<locals>.send_response() missing 1 required positional argument: 'response_headers'
2025-02-28 16:12:22,495 [MainThread] INFO [HandleRequest.do_GET:68] [req_1740787942495] Received GET request for path: /
2025-02-28 16:12:22,496 [MainThread] INFO [HandleRequest.do_GET:73] [req_1740787942495] Received parameters: {'query': 'food movies', 'site': 'imdb', 'model': 'auto', 'prev': '[]'}
2025-02-28 16:12:22,499 [MainThread] ERROR [HandleRequest.do_GET:102] [req_1740787942495] Error handling request: 'HandleRequest' object has no attribute 'send_header'
2025-02-28 16:12:22,501 [MainThread] ERROR [HandleRequest.do_GET:103] [req_1740787942495] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/StreamingWrapper.py", line 84, in do_GET
    self._start_sse_response()
    ~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/Users/guha/nlweb/c2/StreamingWrapper.py", line 187, in _start_sse_response
    self.send_header('Content-Type', 'text/event-stream')
    ^^^^^^^^^^^^^^^^
AttributeError: 'HandleRequest' object has no attribute 'send_header'

2025-02-28 16:12:22,501 [MainThread] CRITICAL [HandleRequest.do_GET:122] [req_1740787942495] Critical error during error handling: handle_client.<locals>.send_response() missing 1 required positional argument: 'response_headers'
2025-02-28 16:16:01,770 [MainThread] INFO [HandleRequest.do_GET:69] [req_1740788161770] Received GET request for path: /
2025-02-28 16:16:01,771 [MainThread] INFO [HandleRequest.do_GET:74] [req_1740788161770] Received parameters: {'query': 'food movies', 'site': 'imdb', 'model': 'auto', 'prev': '[]'}
2025-02-28 16:16:01,772 [MainThread] INFO [HandleRequest.do_GET:92] [req_1740788161770] Processing query with handler: BaseNLWebHandler
2025-02-28 16:16:01,772 [MainThread] INFO [HandleRequest.handle_query:122] [query_1740788161772] Starting query handling for site: i, query_id: 
2025-02-28 16:16:09,683 [MainThread] ERROR [asyncio.default_exception_handler:1858] Unhandled exception in client_connected_cb
transport: <_SelectorSocketTransport closed fd=12>
Traceback (most recent call last):
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/pymilvus/decorators.py", line 86, in handler
    return func(*args, **kwargs)
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/pymilvus/client/grpc_handler.py", line 836, in search
    return self._execute_search(request, timeout, round_decimal=round_decimal, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/pymilvus/client/grpc_handler.py", line 777, in _execute_search
    raise e from e
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/pymilvus/client/grpc_handler.py", line 765, in _execute_search
    response = self._stub.Search(request, timeout=timeout)
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/grpc/_interceptor.py", line 277, in __call__
    response, ignored_call = self._with_call(
                             ~~~~~~~~~~~~~~~^
        request,
        ^^^^^^^^
    ...<4 lines>...
        compression=compression,
        ^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/grpc/_interceptor.py", line 332, in _with_call
    return call.result(), call
           ~~~~~~~~~~~^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/grpc/_channel.py", line 440, in result
    raise self
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/grpc/_interceptor.py", line 315, in continuation
    response, call = self._thunk(new_method).with_call(
                     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        request,
        ^^^^^^^^
    ...<4 lines>...
        compression=new_compression,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/grpc/_interceptor.py", line 343, in with_call
    return self._with_call(
           ~~~~~~~~~~~~~~~^
        request,
        ^^^^^^^^
    ...<4 lines>...
        compression=compression,
        ^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/grpc/_interceptor.py", line 332, in _with_call
    return call.result(), call
           ~~~~~~~~~~~^^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/grpc/_channel.py", line 440, in result
    raise self
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/grpc/_interceptor.py", line 315, in continuation
    response, call = self._thunk(new_method).with_call(
                     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        request,
        ^^^^^^^^
    ...<4 lines>...
        compression=new_compression,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/grpc/_channel.py", line 1198, in with_call
    return _end_unary_response_blocking(state, call, True, None)
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/grpc/_channel.py", line 1006, in _end_unary_response_blocking
    raise _InactiveRpcError(state)  # pytype: disable=not-instantiable
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
grpc._channel._InactiveRpcError: <_InactiveRpcError of RPC that terminated with:
	status = StatusCode.UNAVAILABLE
	details = "failed to connect to all addresses; last error: UNKNOWN: unix:/var/folders/h_/pvhtmm4d7yq6fk4n2vm0ymgh0000gn/T/tmp39s7jph8_milvus_prod.db.sock: connect: Connection refused (61)"
	debug_error_string = "UNKNOWN:Error received from peer  {created_time:"2025-02-28T16:16:07.479256-08:00", grpc_status:14, grpc_message:"failed to connect to all addresses; last error: UNKNOWN: unix:/var/folders/h_/pvhtmm4d7yq6fk4n2vm0ymgh0000gn/T/tmp39s7jph8_milvus_prod.db.sock: connect: Connection refused (61)"}"
>

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 708, in run_until_complete
    self.run_forever()
    ~~~~~~~~~~~~~~~~^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 679, in run_forever
    self._run_once()
    ~~~~~~~~~~~~~~^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 2027, in _run_once
    handle._run()
    ~~~~~~~~~~~^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/events.py", line 89, in _run
    self._context.run(self._callback, *self._args)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/guha/nlweb/c2/WebServer.py", line 91, in handle_client
    await fulfill_request(
    ...<7 lines>...
    )
  File "/Users/guha/nlweb/c2/WebServer.py", line 189, in fulfill_request
    await hr.do_GET()
  File "/Users/guha/nlweb/c2/StreamingWrapper.py", line 93, in do_GET
    await self.handle_query(site, query, prev, model, query_id, context_url)
  File "/Users/guha/nlweb/c2/StreamingWrapper.py", line 131, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/baseHandler.py", line 152, in getRankedAnswers
    top_embeddings = retriever.search_db(self.decontextualized_query, self.site)
  File "/Users/guha/nlweb/c2/retriever.py", line 33, in search_db
    res = client.search(
        collection_name="prod_collection",
    ...<3 lines>...
        output_fields=["url", "text", "name", "site"],
    )
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/pymilvus/milvus_client/milvus_client.py", line 398, in search
    res = conn.search(
        collection_name,
    ...<9 lines>...
        **kwargs,
    )
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/pymilvus/decorators.py", line 137, in handler
    return func(*args, **kwargs)
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/pymilvus/decorators.py", line 176, in handler
    return func(self, *args, **kwargs)
  File "/Users/guha/mahi/v1/lib/python3.13/site-packages/pymilvus/decorators.py", line 102, in handler
    time.sleep(back_off)
    ~~~~~~~~~~^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 157, in _on_sigint
    raise KeyboardInterrupt()
KeyboardInterrupt
2025-02-28 16:18:27,877 [MainThread] INFO [HandleRequest.do_GET:69] [req_1740788307877] Received GET request for path: /
2025-02-28 16:18:27,878 [MainThread] INFO [HandleRequest.do_GET:74] [req_1740788307877] Received parameters: {'query': 'food movies', 'site': 'imdb', 'model': 'auto', 'prev': '[]'}
2025-02-28 16:18:27,878 [MainThread] INFO [HandleRequest.do_GET:92] [req_1740788307877] Processing query with handler: GraphStructureHandler
2025-02-28 16:18:27,878 [MainThread] INFO [HandleRequest.handle_query:122] [query_1740788307878] Starting query handling for site: imdb, query_id: ['']
2025-02-28 16:18:29,825 [MainThread] ERROR [HandleRequest.handle_query:137] [query_1740788307878] Error in handle_query: 'SendChunkWrapper' object has no attribute 'logger'
2025-02-28 16:18:29,828 [MainThread] ERROR [HandleRequest.handle_query:138] [query_1740788307878] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/StreamingWrapper.py", line 131, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/graph.py", line 64, in getRankedAnswers
    await self.analyzeQuery()
  File "/Users/guha/nlweb/c2/graph.py", line 61, in analyzeQuery
    self.http_handler.logger.info(f"item_type in graph: {self.item_type}")
    ^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'SendChunkWrapper' object has no attribute 'logger'

2025-02-28 16:18:29,828 [MainThread] ERROR [HandleRequest.do_GET:95] [req_1740788307877] Error in query handling: 'SendChunkWrapper' object has no attribute 'logger'
2025-02-28 16:18:29,829 [MainThread] ERROR [HandleRequest.do_GET:96] [req_1740788307877] Inner traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/StreamingWrapper.py", line 93, in do_GET
    await self.handle_query(site, query, prev, model, query_id, context_url)
  File "/Users/guha/nlweb/c2/StreamingWrapper.py", line 131, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/graph.py", line 64, in getRankedAnswers
    await self.analyzeQuery()
  File "/Users/guha/nlweb/c2/graph.py", line 61, in analyzeQuery
    self.http_handler.logger.info(f"item_type in graph: {self.item_type}")
    ^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'SendChunkWrapper' object has no attribute 'logger'

2025-02-28 16:18:29,829 [MainThread] ERROR [HandleRequest.do_GET:100] [req_1740788307877] Error handling request: 'SendChunkWrapper' object has no attribute 'logger'
2025-02-28 16:18:29,830 [MainThread] ERROR [HandleRequest.do_GET:101] [req_1740788307877] Traceback: Traceback (most recent call last):
  File "/Users/guha/nlweb/c2/StreamingWrapper.py", line 93, in do_GET
    await self.handle_query(site, query, prev, model, query_id, context_url)
  File "/Users/guha/nlweb/c2/StreamingWrapper.py", line 131, in handle_query
    await handler.getRankedAnswers()
  File "/Users/guha/nlweb/c2/graph.py", line 64, in getRankedAnswers
    await self.analyzeQuery()
  File "/Users/guha/nlweb/c2/graph.py", line 61, in analyzeQuery
    self.http_handler.logger.info(f"item_type in graph: {self.item_type}")
    ^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'SendChunkWrapper' object has no attribute 'logger'

